var FLIPBOOK=FLIPBOOK||{};{FLIPBOOK.PageWebGL=function(e,t,n,r,i,s,o,u){this.book=e;this.preloader=o;this.frontTexture=n;this.backTexture=r;this.index=t;this.materialType=s.pageMaterial;this.pW=s.pageWidth;this.pH=s.pageHeight;this.pageShininess=s.pageShininess;this.nfacesw=s.pageSegmentsW;this.nfacesh=s.pageSegmentsH;this.mats=[];this.pageHardness=i;this.pageThickness=i;this.duration=s.pageFlipDuration;this.angle=.25*Math.PI*this.pW/this.pH;this.force=10;this.offset=0;this.to=null;this.mod=null;this.bend=null;this.pivot=null;this.isFlippedLeft=false;this.isFlippedRight=true;this.flippingLeft=false;this.flippingRight=false;this.zz=2;this.sides={bottom:3,top:2,right:0,left:1,front:4,back:5};var a;for(var f=0;f<6;f++){if(f==this.sides.front){this.mats[this.sides.front]=this.createEmptyMaterial(this.materialType)}else if(f==this.sides.back){this.mats[this.sides.back]=this.createEmptyMaterial(this.materialType)}else{var l=parseInt(Math.random()*5);var c=[7829367,10066329,11184810,14540253,16777215];var h=c[l];this.mats[f]=new THREE.MeshBasicMaterial({color:h})}}THREE.Mesh.call(this,new THREE.CubeGeometry(this.pW,this.pH,.1,this.nfacesw,this.nfacesh,1),new THREE.MeshFaceMaterial(this.mats));this.overdraw=false;this.position.x=this.pW*.5;this.mod=new MOD3.ModifierStack(new MOD3.LibraryThree,this);this.pivot=new MOD3.Pivot(this.position.x,0,0);this.mod.addModifier(this.pivot);this.mod.collapse();this.bend=new MOD3.Bend(0,0,0);this.bend.constraint=MOD3.ModConstant.LEFT;if(this.pH>this.pW)this.bend.switchAxes=true;this.mod.addModifier(this.bend)};FLIPBOOK.PageWebGL.prototype=new THREE.Mesh;FLIPBOOK.PageWebGL.prototype.constructor=FLIPBOOK.PageWebGL;FLIPBOOK.PageWebGL.prototype.load=function(){if(this.loaded)return;var e,t=this;var n=this.book.options,r=n.main;if(n.pdfUrl!=""&&this.loadedFromPdf!=true){this.loadFromPdf();return}e=THREE.ImageUtils.loadTexture(t.frontTexture,null,function(){t.mats[t.sides.front]=t.createMaterial(t.materialType,e);e=THREE.ImageUtils.loadTexture(t.backTexture,null,function(){t.mats[t.sides.back]=t.createMaterial(t.materialType,e);t.material=new THREE.MeshFaceMaterial(t.mats);t.loaded=true})})};FLIPBOOK.PageWebGL.prototype.loadFromPdf=function(){var e=this.book.options,t=e.main,n=this;if(e.rightToLeft){var r=this.book.pages.length-this.index-1;t.loadPagesFromPdf([r*2,r*2+1],function(){n.loadedFromPdf=true;n.frontTexture=e.pages[2*n.index].src;n.backTexture=e.pages[2*n.index+1].src;n.load()})}else{t.loadPagesFromPdf([this.index*2,this.index*2+1],function(){n.loadedFromPdf=true;n.frontTexture=e.pages[2*n.index].src;n.backTexture=e.pages[2*n.index+1].src;n.load()})}};FLIPBOOK.PageWebGL.prototype.createEmptyMaterial=function(e){var t;if(e=="lambert"){t=new THREE.MeshLambertMaterial({map:this.preloader,overdraw:this.overdraw,ambient:14540253,specular:16777215,diffuse:16777215,shininess:20,perPixel:true})}else if(e=="phong"){t=new THREE.MeshPhongMaterial({map:this.preloader,overdraw:this.overdraw,ambient:14540253,specular:16777215,diffuse:16777215,shininess:20,perPixel:true})}else if(e=="basic"){t=new THREE.MeshBasicMaterial({map:this.preloader,overdraw:this.overdraw,perPixel:true})}return t};FLIPBOOK.PageWebGL.prototype.createMaterial=function(e,t){var n;if(e=="lambert"){n=new THREE.MeshLambertMaterial({map:t,ambient:14540253,specular:16777215,diffuse:16777215,shininess:20,perPixel:false})}else if(e=="phong"){n=new THREE.MeshPhongMaterial({map:t,ambient:14540253,specular:16777215,diffuse:16777215,shininess:20,perPixel:false})}else if(e=="basic"){n=new THREE.MeshBasicMaterial({map:t,perPixel:false})}return n};FLIPBOOK.PageWebGL.prototype.flipLeft=function(e){this.onComplete=e;if(!this.isFlippedLeft&&!this.flippingLeft&&!this.flippingRight&&this.index==this.book.flippedleft){if(this.duration>0){this.flippingLeft=true;this.flipping=true;this.force=0;var t=(1+Math.random()*.5)/this.pageHardness;var n=.1+Math.random()*.2;this.to={angle:this.rotation.y,t:-1,xx:0,thiss:this,force:this.force,offset:this.offset};this.bendIn(-Math.PI,t,n)}else{this.rotation.y=-Math.PI;this.flippingLeft=false;this.isFlippedLeft=true;this.flippingRight=false;this.isFlippedRight=false}var r=4;this.position.z=r/2+1;for(var i=this.index-1;i>=0;i--){this.book.pages[i].position.z=this.book.pages[i+1].position.z-r/2-r/2-1}for(var i=this.index+1;i<this.book.pages.length;i++){this.book.pages[i].position.z=this.book.pages[i-1].position.z-r/2-r/2-1}}};FLIPBOOK.PageWebGL.prototype.flipLeftInstant=function(e){this.onComplete=e;if(!this.isFlippedLeft&&!this.flippingLeft&&!this.flippingRight&&this.index==this.book.flippedleft){this.thiss=this;this.xx=0;this.angle=-Math.PI;this.flippingLeft=true;this.isFlippedLeft=false;this.renderFlip();this.flippingLeft=false;this.isFlippedLeft=true;this.flippingRight=false;this.isFlippedRight=false;var t=4;this.position.z=t/2+1;for(var n=this.index+1;n<this.book.pages.length;n++){this.book.pages[n].position.z=this.book.pages[n-1].position.z-t/2-t/2-1}if(this.index<this.book.pages.length-1){this.position.z=this.book.pages[this.index+1].position.z;for(var n=this.index-1;n>=0;n--){this.book.pages[n].position.z=this.book.pages[n+1].position.z-t/2-t/2-1}}else{if(this.index>0)this.book.pages[this.index].position.z=this.book.pages[this.index-1].position.z+t/2+t/2-1}this.flipFinished()}};FLIPBOOK.PageWebGL.prototype.flipRightInstant=function(e){this.onComplete=e;if(!this.isFlippedRight&&!this.flippingRight&&!this.flippingLeft&&this.index==this.book.getNumPages()-this.book.flippedright-1){this.thiss=this;this.xx=0;this.angle=0;this.flippingRight=true;this.isFlippedRight=false;this.renderFlip();this.flippingLeft=false;this.isFlippedLeft=false;this.flippingRight=false;this.isFlippedRight=true;var t=4;this.position.z=t/2+1;for(var n=this.index-1;n>=0;n--){this.book.pages[n].position.z=this.book.pages[n+1].position.z-t/2-t/2-1}if(this.index>0){this.position.z=this.book.pages[this.index-1].position.z;for(var n=this.index+1;n<this.book.pages.length;n++){this.book.pages[n].position.z=this.book.pages[n-1].position.z-t/2-t/2-1}}else{if(this.book.pages.length>1)this.position.z=this.book.pages[this.index+1].position.z+t/2+t/2-1}this.flipFinished()}};FLIPBOOK.PageWebGL.prototype.flipRight=function(e){this.onComplete=e;if(!this.isFlippedRight&&!this.flippingRight&&!this.flippingLeft&&this.index==this.book.getNumPages()-this.book.flippedright-1){if(this.duration>0){this.flippingRight=true;this.flipping=true;this.force=0;this.to={angle:this.rotation.y,t:-1,xx:0,thiss:this,force:this.force,offset:this.offset};var t=(-1-Math.random()*.5)/this.pageHardness;var n=.1+Math.random()*.2;this.bendIn(0,t,n)}else{this.rotation.y=0;this.flippingLeft=false;this.isFlippedLeft=false;this.flippingRight=false;this.isFlippedRight=true}var r=4;this.position.z=r/2+1;for(var i=this.index+1;i<this.book.pages.length;i++){this.book.pages[i].position.z=this.book.pages[i-1].position.z-r/2-r/2-1}for(var i=this.index-1;i>=0;i--){this.book.pages[i].position.z=this.book.pages[i+1].position.z-r/2-r/2-1}}};FLIPBOOK.PageWebGL.prototype.bendIn=function(e,t,n){this.bend.setAngle(Math.random()*(Math.PI/24)-Math.PI/48);this.bend.force=0;this.bend.offset=0;this.mod.apply();var r=this.duration*(400+this.pageHardness*5);var i=this.duration*(300+this.pageHardness*5);(new TWEEN.Tween(this.to)).to({angle:e,xx:1,t:1},r).easing(TWEEN.Easing.Sinusoidal.EaseInOut).onUpdate(this.renderFlip).start();(new TWEEN.Tween(this.to)).to({force:t},i).easing(TWEEN.Easing.Quadratic.EaseInOut).onUpdate(this.modApply).onComplete(this.bendOut).start();(new TWEEN.Tween(this.to)).to({offset:n},i).easing(TWEEN.Easing.Quadratic.EaseOut).onUpdate(this.modApply).start();this.book.options.main.playFlipSound()};FLIPBOOK.PageWebGL.prototype.bendOut=function(){var e=this.thiss;var t=e.duration*(700-e.pageHardness*50);(new TWEEN.Tween(e.to)).to({force:0,offset:1},t).easing(TWEEN.Easing.Sinusoidal.EaseOut).onUpdate(e.modApply).onComplete(e.flipFinished).start();var n=4;if(e.flippingLeft){if(e.index<e.book.pages.length-1){e.position.z=e.book.pages[e.index+1].position.z;for(var r=e.index-1;r>=0;r--){e.book.pages[r].position.z=e.book.pages[r+1].position.z-n/2-n/2-1}}else{if(e.book.pages.length>1)e.book.pages[e.index].position.z=e.book.pages[e.index-1].position.z+n/2+n/2-1}}if(e.flippingRight){if(e.index>0){e.position.z=e.book.pages[e.index-1].position.z;for(var r=e.index+1;r<e.book.pages.length;r++){e.book.pages[r].position.z=e.book.pages[r-1].position.z-n/2-n/2-1}}else{if(e.book.pages.length>1)e.position.z=e.book.pages[e.index+1].position.z+n/2+n/2-1}}};FLIPBOOK.PageWebGL.prototype.modApply=function(){this.thiss.bend.force=this.force;this.thiss.bend.offset=this.offset;this.thiss.mod.apply()};FLIPBOOK.PageWebGL.prototype.renderFlip=function(){var e=Math.PI*.5;if(this.thiss.flippingLeft&&this.thiss.index==0&&this.thiss.book.getNumPages()>1)this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x;else if(this.thiss.flippingLeft&&this.thiss.index==this.thiss.book.getNumPages()-1)this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x+this.xx*this.thiss.book.pageW*.5;else if(this.thiss.flippingRight&&this.thiss.index==0)this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x-this.xx*this.thiss.book.pageW*.5;else if(this.thiss.flippingRight&&this.thiss.index==this.thiss.book.getNumPages()-1)this.thiss.book.centerContainer.position.x=(1-this.xx)*this.thiss.book.centerContainer.position.x;this.thiss.rotation.y=this.angle};FLIPBOOK.PageWebGL.prototype.flipFinished=function(){var e=this.thiss;if(e.flippingLeft){e.flippingLeft=false;e.isFlippedLeft=true;e.flippingRight=false;e.isFlippedRight=false}else if(e.flippingRight){e.flippingLeft=false;e.isFlippedRight=true;e.flippingRight=false;e.isFlippedLeft=false}e.bend.force=0;e.bend.offset=0;e.mod.apply();e.flipping=false;if(typeof e.onComplete!="undefined")e.onComplete(e);e.book.flipFinnished();e.book.options.main.turnPageComplete()};FLIPBOOK.PageWebGL.prototype.isFlippedLeft=function(){return this.thiss.isFlippedLeft};FLIPBOOK.PageWebGL.prototype.isFlippedRight=function(){return this.thiss.isFlippedRight}}{FLIPBOOK.BookWebGL=function(e,t){this.elementId=jQuery(t.main.elem).attr("id");this.wrapper=typeof e=="object"?e:document.getElementById(e);this.options=t;this.pageW=t.pageWidth;this.pageH=t.pageHeight;this.scroll=t.scroll;this.pagesArr=t.pagesArr;this.pages=[];this.animating=false;this.rightIndex=0;this.sc=1;var n=this.wrapper.style;n.width="100%";n.height="100%";n.position="absolute";n.overflow="hidden";if(!t.lightBox||t.lightBoxOpened){this.enable()}};FLIPBOOK.BookWebGL.prototype=new THREE.Object3D;FLIPBOOK.BookWebGL.prototype.constructor=FLIPBOOK.BookWebGL;FLIPBOOK.BookWebGL.prototype.init3d=function(){var e=this,t=30,n=jQuery(e.wrapper).width(),r=jQuery(e.wrapper).height(),i=n/r,s=1,o=1e4,u=this.options;e.clock=new THREE.Clock;e.scene=new THREE.Scene;e.camera=new THREE.PerspectiveCamera(t,i,s,o);e.scene.add(e.camera);e.zoom=u.zoom;e.pan=u.pan;e.tilt=u.tilt;this.updateCameraPosition();this.canvas=document.createElement("canvas");jQuery(this.canvas).attr("id",Math.random());var a=this.canvas.style;a.width="100%";a.height="100%";a.position="absolute";a.left="0";a.top="0";this._bind("mouseout",this.canvas);this._bind(this.options.parent.START_EV,this.canvas);this._bind(this.options.parent.MOVE_EV,this.canvas);this._bind(this.options.parent.END_EV,this.canvas);this._bind(this.options.parent.CANCEL_EV,this.canvas);if(e.options.renderer=="webgl"){e.renderer=new THREE.WebGLRenderer({alpha:true,antialias:true,canvas:this.canvas});e.renderer.setClearColor(16777215,0);e.renderer.setClearColor(0,0)}else if(e.options.renderer=="canvas"){e.renderer=new THREE.CanvasRenderer({antialias:true,canvas:this.canvas})}else if(e.options.renderer=="css3d"){}e.renderer.setSize(n,r);if(u.pageShadow){}jQuery(window).resize(function(){e.onResize()});if(u.pointLight==true){var f=new THREE.PointLight(u.pointLightColor);f.position.set(u.pointLightX,u.pointLightY,u.pointLightZ);f.intensity=u.pointLightIntensity;e.scene.add(f)}if(u.directionalLight==true){var l=new THREE.DirectionalLight(u.directionalLightColor);l.position.set(u.directionalLightX,u.directionalLightY,u.directionalLightZ);l.intensity=u.directionalLightIntensity;e.scene.add(l)}if(u.ambientLight==true){var c=new THREE.AmbientLight(u.ambientLightColor);c.intensity=u.ambientLightIntensity;e.scene.add(c)}if(u.spotLight){var h=new THREE.SpotLight(u.spotLightColor);h.position.z=u.spotLightZ;h.intensity=u.spotLightIntensity;e.scene.add(h)}e.scene.add(this);this.position.set(u.bookX,u.bookY,u.bookZ);this.centerContainer=new THREE.Object3D;this.add(this.centerContainer);this.centerContainer.position.x=-this.pageW*.5;if(this.options.rightToLeft){this.centerContainer.position.x=this.pageW*.5}this.flippedleft=0;this.flippedright=0;this.cameraZMin=300;this.cameraZMax=5e3};FLIPBOOK.BookWebGL.prototype.onResize=function(){var e=jQuery(this.wrapper).width(),t=jQuery(this.wrapper).height();if(t>e){this.sc=e/t}else{this.sc=1}if(e/t<2*this.options.pageWidth/this.options.pageHeight){this.sc/=2*this.options.pageWidth/this.options.pageHeight/(e/t)}this.renderer.setSize(e,t);this.camera.aspect=e/t;this.camera.updateProjectionMatrix();this.updateCameraPosition()};FLIPBOOK.BookWebGL.prototype.updateCameraPosition=function(){var e=Math.PI*this.tilt/180;var t=0;var n=this.options.cameraDistance*Math.sin(e)/this.zoom;var r=this.options.cameraDistance*Math.cos(e)/this.zoom;this.scale.set(this.sc,this.sc,this.sc);e=Math.PI*this.pan/180;t=Math.sin(e)*r;r=Math.cos(e)*r;this.camera.position.set(Math.round(t),Math.round(n),Math.round(r));this.camera.lookAt(this.scene.position)};FLIPBOOK.BookWebGL.prototype.createPages=function(){var e=this;var t,n,r,i,s;var o=THREE.ImageUtils.loadTexture(this.options.assets.preloader,null,function(){for(s=0;s<e.pagesArr.length/2;s++){t=e.pagesArr[2*s].src;n=2*s+1>=e.pagesArr.length?"":e.pagesArr[2*s+1].src;r=s==0||s==e.pagesArr.length/2-1?e.options.coverHardness:e.options.pageHardness;i=new FLIPBOOK.PageWebGL(e,s,t,n,r,e.options,o);e.pages.push(i);e.centerContainer.add(i);e.flippedright++;if(e.options.loadAllPages)i.load();var u=4;if(s>0)i.position.z=e.pages[s-1].position.z-u/2-u/2-1;else i.position.z=u/2}e.initialized=true;if(e.options.rightToLeft){e.pages[e.pages.length-1].load();if(e.pages.length>1)e.pages[e.pages.length-2].load()}else{e.pages[0].load();if(e.pages.length>1)e.pages[1].load()}})};FLIPBOOK.BookWebGL.prototype.getNumPages=function(){return this.pages.length};FLIPBOOK.BookWebGL.prototype.centerContainer=function(){return this.centerContainer};FLIPBOOK.BookWebGL.prototype.goToPage=function(e,t){if(!this.initialized){var n=this;setTimeout(function(){n.goToPage(e,t)},100);return}this.goingToPage=e;e%2!=0?e++:e;var n=this;var r=this.options.pageFlipDuration*1e3/8;if(typeof t!="undefined"&&t){if(e>n.rightIndex){while(n.rightIndex<e)this.nextPageInstant()}else{while(n.rightIndex>e)this.prevPageInstant()}var i=this.pages[this.flippedleft];if(i)i.load();var s=this.pages[this.flippedleft-1];if(s)s.load();return}if(this.rightIndex>e){r=1/(this.rightIndex-e)*this.options.pageFlipDuration*1e3/8;if(this.rightIndex-e>10)r=0;if(this.rightIndex-2>e){this.prevPage(false);if(r>0)setTimeout(function(){n.goToPage(e,t)},r);else n.goToPage(e,t)}else{this.prevPage();setTimeout(function(){if(typeof t!="undefined"&&t){for(var e=0;e<n.pages.length;e++){n.pages[e].duration=n.options.pageFlipDuration}}n.options.main.turnPageComplete()},r)}}else if(this.rightIndex<e){r=-1/(this.rightIndex-e)*this.options.pageFlipDuration*1e3/8;if(this.rightIndex-e<-10)r=0;if(this.rightIndex+2<e){this.nextPage(false);if(r>0)setTimeout(function(){n.goToPage(e,t)},r);else n.goToPage(e,t)}else{this.nextPage();setTimeout(function(){if(typeof t!="undefined"&&t){for(var e=0;e<n.pages.length;e++){n.pages[e].duration=n.options.pageFlipDuration}}n.options.main.turnPageComplete()},r)}}};FLIPBOOK.BookWebGL.prototype.nextPageInstant=function(e){if(this.flippedright==0)return;var t;for(t=0;t<this.pages.length;t++){if(this.pages[t].flippingRight)return}var n=this.pages[this.pages.length-this.flippedright];n.flipLeftInstant();this.flippedleft++;this.flippedright--;this.rightIndex+=2;this.options.main.turnPageComplete();this.updateBookPosition()};FLIPBOOK.BookWebGL.prototype.prevPageInstant=function(e){if(this.flippedleft==0)return;var t;for(t=0;t<this.pages.length;t++){if(this.pages[t].flippingLeft)return}var n=this.pages[this.flippedleft-1];n.flipRightInstant();this.flippedleft--;this.flippedright++;this.rightIndex-=2;this.options.main.turnPageComplete();this.updateBookPosition()};FLIPBOOK.BookWebGL.prototype.nextPage=function(e){if(this.flippedright==0)return;var t;for(t=0;t<this.pages.length;t++){if(this.pages[t].flippingRight)return}var n=this.pages[this.pages.length-this.flippedright];var r=this.pages[this.flippedleft+1];var i=this.pages[this.flippedleft];if(!n.flipping){var s=this,o;if(typeof e=="undefined"||e){o=function(e){var t=s.pages[s.flippedleft];var n=s.pages[s.flippedleft-1];var r=s.pages[s.flippedleft-2];var i=s.pages[s.flippedleft+1];if(t)t.load();if(n)n.load();if(r)r.load();if(i)i.load()}}n.flipLeft(o)}this.flippedleft++;this.flippedright--;this.rightIndex+=2};FLIPBOOK.BookWebGL.prototype.updateBookPosition=function(){if(this.rightIndex==0)this.centerContainer.position.x=-this.options.pageWidth/2;else if(this.rightIndex==this.options.pages.length)this.centerContainer.position.x=this.options.pageWidth/2;else this.centerContainer.position.x=0};FLIPBOOK.BookWebGL.prototype.prevPage=function(e){if(this.flippedleft==0)return;var t;for(t=0;t<this.pages.length;t++){if(this.pages[t].flippingLeft)return}var n=this.pages[this.flippedleft-1];var r=this.pages[this.flippedleft-1];var i=this.pages[this.flippedleft-2];if(!n.flipping){var s=this,o;if(typeof e=="undefined"||e){o=function(e){var t=s.pages[s.flippedleft];var n=s.pages[s.flippedleft-1];var r=s.pages[s.flippedleft-2];var i=s.pages[s.flippedleft+1];if(t)t.load();if(n)n.load();if(r)r.load();if(i)i.load()}}n.flipRight(o)}this.flippedleft--;this.flippedright++;this.rightIndex-=2};FLIPBOOK.BookWebGL.prototype.firstPage=function(){};FLIPBOOK.BookWebGL.prototype.flipFinnished=function(){};FLIPBOOK.BookWebGL.prototype.lastPage=function(){};FLIPBOOK.BookWebGL.prototype.updateVisiblePages=function(){};FLIPBOOK.BookWebGL.prototype.render=function(e){var t=this;t.rendering=e;if(!e)jQuery(t.wrapper).find("canvas").remove();else t.wrapper.appendChild(t.renderer.domElement);t.animate=function(){if(t.rendering){if(!t.enabled){return}requestAnimationFrame(t.animate);TWEEN.update();t.renderer.render(t.scene,t.camera)}};t.animate()};FLIPBOOK.BookWebGL.prototype.zoomTo=function(e,t){if(typeof t==="undefined")t=200;var n=this;newZoom=e>this.options.zoomMax?this.options.zoomMax:e;newZoom=e<this.options.zoomMin?this.options.zoomMin:e;this.zooming=true;if(newZoom==this.options.zoom){var r=this.options;this.position.set(r.bookX,r.bookY,r.bookZ)}(new TWEEN.Tween(this)).to({zoom:newZoom},t).easing(TWEEN.Easing.Sinusoidal.EaseInOut).onUpdate(this.updateCameraPosition).onComplete(function(){n.zooming=false}).start();n.options.parent.onZoom(newZoom)};FLIPBOOK.BookWebGL.prototype.tiltTo=function(e){var t=this,n=.3;var r=this.tilt+e*n;r=r>this.options.tiltMax?this.options.tiltMax:r;r=r<this.options.tiltMin?this.options.tiltMin:r;this.tilt=r;this.updateCameraPosition()};FLIPBOOK.BookWebGL.prototype.panTo=function(e){var t=this,n=.2;var r=this.pan-e*n;r=r>this.options.panMax?this.options.panMax:r;r=r<this.options.panMin?this.options.panMin:r;this.pan=r;this.updateCameraPosition()};FLIPBOOK.BookWebGL.prototype._bind=function(e,t,n){(t||this.wrapper).addEventListener(e,this,!!n)};FLIPBOOK.BookWebGL.prototype.handleEvent=function(e){var t=this;switch(e.type){case t.options.parent.START_EV:if(!t.options.parent.hasTouch&&e.button!==0)return;t._start(e);break;case t.options.parent.MOVE_EV:t._move(e);break;case"mouseout":t._end(e);break;case t.options.parent.END_EV:case t.options.parent.CANCEL_EV:t._end(e);break}};FLIPBOOK.BookWebGL.prototype.resetCameraPosition=function(){this.position.x=this.options.bookX;this.position.y=this.options.bookY;this.position.z=this.options.bookZ};FLIPBOOK.BookWebGL.prototype._start=function(e){this.mouseDown=true;var t=this.options.parent.hasTouch?e.touches[0]:e;this.pointX=t.pageX;this.pointY=t.pageY;this.startPoint=t;var n=this._getVector(e);var r=new THREE.Projector;r.unprojectVector(n,this.camera);var i=new THREE.Raycaster(this.camera.position,n.sub(this.camera.position).normalize());var s=i.intersectObjects(this.pages);this.pageMouseDown=s.length>0};FLIPBOOK.BookWebGL.prototype._getVector=function(e){var t=jQuery(this.canvas).width(),n=jQuery(this.canvas).height(),r=e.pageX-jQuery(this.canvas).offset().left,i=e.pageY-jQuery(this.canvas).offset().top,s=jQuery(this.canvas).offset().x,o=jQuery(this.canvas).offset().y;return new THREE.Vector3(r/t*2-1,-(i/n)*2+1,.5)};FLIPBOOK.BookWebGL.prototype._move=function(e){e.preventDefault();var t=this._getVector(e);var n=new THREE.Projector;n.unprojectVector(t,this.camera);var r=new THREE.Raycaster(this.camera.position,t.sub(this.camera.position).normalize());var i=r.intersectObjects(this.pages);if(i.length>0){this.wrapper.style.cursor="pointer"}else{this.wrapper.style.cursor="auto"}var s=this.options.parent.hasTouch?e.touches[0]:e,o=(s.pageX-this.pointX)*.5,u=(s.pageY-this.pointY)*.5;this.pointX=s.pageX;this.pointY=s.pageY;if(!this.mouseDown){this.onMouseMove="";return}if(i.length>0){if(this.onMouseMove==""){if(this.zoom>this.options.zoom)this.onMouseMove="scroll"}}else{if(this.onMouseMove=="")this.onMouseMove="rotate"}if(this.onMouseMove=="scroll"){this.position.x+=4*o/this.zoom;this.position.y-=4*u/this.zoom}else if(this.onMouseMove=="rotate"){this.tiltTo(u);this.panTo(o)}};FLIPBOOK.BookWebGL.prototype._end=function(e){this.mouseDown=false;var t=this.options.parent.hasTouch?e.touches[0]:e;this.pointX=t.pageX;this.pointY=t.pageY;this.endPoint=t;var n=this._getVector(e);var r=new THREE.Projector;r.unprojectVector(n,this.camera);var i=new THREE.Raycaster(this.camera.position,n.sub(this.camera.position).normalize());var s=i.intersectObjects(this.pages);if(s.length>0){if(this.pageMouseDown&&Math.abs(this.startPoint.pageX-this.endPoint.pageX)<5&&Math.abs(this.startPoint.pageY-this.endPoint.pageY)<5){var o=s[0];var u=o.object;if(u.flipping)return;if(u.isFlippedLeft)this.prevPage();else this.nextPage()}}this.pageMouseDown=false};FLIPBOOK.BookWebGL.prototype.moveCamera=function(e,t){};FLIPBOOK.BookWebGL.prototype.enable=function(){if(this.enabled){this.onResize();return}this.enabled=true;if(!this.initialized){this.init3d();this.createPages();this.rendering=false;this.onResize()}this.render(true);this.onResize()};FLIPBOOK.BookWebGL.prototype.disable=function(){this.enabled=false;this.render(false)}}{var MOD3=MOD3||{};(function(e){e.Constants={PI:Math.PI,invPI:1/Math.PI,halfPI:.5*Math.PI,doublePI:2*Math.PI,toRad:1/180*Math.PI,toDeg:1/180*Math.PI};e.ModConstant={LEFT:-1,RIGHT:1,NONE:0,X:1,Y:2,Z:4}})(MOD3);(function(e){var t=e.Constants;e.XMath={};e.XMath.normalize=function(t,n,r){return n-t==0?1:e.XMath.trim(0,1,(r-t)/n)};e.XMath.toRange=function(e,t,n){return t-e==0?0:e+(t-e)*n};e.XMath.inRange=function(e,t,n,r){typeof r=="undefined"&&(r=!1);return r?n>=e&&n<=t:n>e&&n<t};e.XMath.sign=function(e,t){typeof t=="undefined"&&(t=0);return 0==e?t:e>0?1:-1};e.XMath.trim=function(e,t,n){return Math.min(t,Math.max(e,n))};e.XMath.wrap=function(e,t,n){return n<e?n+(t-e):n>=t?n-(t-e):n};e.XMath.degToRad=function(e){return e*t.toRad};e.XMath.radToDeg=function(e){return e*t.toDeg};e.XMath.presicion=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n};e.XMath.uceil=function(e){return e<0?Math.floor(e):Math.ceil(e)}})(MOD3);(function(e){e.Range=function(e,t){this.start=0;this.end=1;if(typeof e!="undefined")this.start=e;if(typeof t!="undefined")this.end=t};e.Range.prototype.getSize=function(){return this.end-this.start};e.Range.prototype.move=function(e){this.start+=e;this.end+=e};e.Range.prototype.isIn=function(e){return e>=this.start&&e<=this.end};e.Range.prototype.normalize=function(t){return e.XMath.normalize(this.start,this.end,t)};e.Range.prototype.toRange=function(t){return e.XMath.toRange(this.start,this.end,t)};e.Range.prototype.trim=function(t){return e.XMath.trim(this.start,this.end,t)};e.Range.prototype.interpolate=function(e,t){return this.toRange(t.normalize(e))};e.Range.prototype.toString=function(){return"["+this.start+" - "+this.end+"]"}})(MOD3);(function(e){e.Phase=function(e){this.value=0;if(typeof e!="undefined")this.value=e};e.Phase.prototype.getPhasedValue=function(){return Math.sin(this.value)};e.Phase.prototype.getAbsPhasedValue=function(){return Math.abs(this.getPhasedValue())};e.Phase.prototype.getNormValue=function(){return(this.getPhasedValue()+1)*.5}})(MOD3);(function(e){e.Point=function(e,t){this.y=this.x=0;if(typeof e!="undefined")this.x=e;if(typeof t!="undefined")this.y=t};e.Point.prototype.clone=function(){return new e.Point(this.x,this.y)}})(MOD3);(function(e){e.Matrix=function(e,t,n,r){this.m11=1;this.m21=this.m12=0;this.m22=1;if(typeof e!="undefined")this.m11=e;if(typeof t!="undefined")this.m12=t;if(typeof n!="undefined")this.m21=n;if(typeof r!="undefined")this.m22=r};e.Matrix.prototype.rotate=function(e){var t=Math.cos(e),e=Math.sin(e);this.m11=t;this.m12=-e;this.m21=e;this.m22=t;return this};e.Matrix.prototype.scale=function(e,t){this.m21=this.m12=0;if(typeof e!="undefined")this.m22=this.m11=e;if(typeof t!="undefined")this.m22=t;return this};e.Matrix.prototype.multiply=function(e){var t=this.m11,n=this.m12,r=this.m21,i=this.m22,s=e.m11,o=e.m12,u=e.m21,e=e.m22;this.m11=t*s+n*u;this.m12=t*o+n*e;this.m21=r*s+i*u;this.m22=r*o+i*e;return this};e.Matrix.prototype.transformPoint=function(t){return new e.Point(this.m11*t.x+this.m12*t.y,this.m21*t.x+this.m22*t.y)}})(MOD3);(function(e){e.Vector3=function(e,t,n){this.z=this.y=this.x=null;this.x=e;this.y=t;this.z=n};e.Vector3.ZERO=function(){return new e.Vector3(0,0,0)};e.Vector3.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z};e.Vector3.prototype.clone=function(){return new e.Vector3(this.x,this.y,this.z)};e.Vector3.prototype.equals=function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z};e.Vector3.prototype.zero=function(){this.x=this.y=this.z=0};e.Vector3.prototype.negate=function(){return new e.Vector3(-this.x,-this.y,-this.z)};e.Vector3.prototype.add=function(t){return new e.Vector3(this.x+t.x,this.y+t.y,this.z+t.z)};e.Vector3.prototype.subtract=function(t){return new e.Vector3(this.x-t.x,this.y-t.y,this.z-t.z)};e.Vector3.prototype.multiplyScalar=function(t){return new e.Vector3(this.x*t,this.y*t,this.z*t)};e.Vector3.prototype.multiply=function(t){return new e.Vector3(this.x*t.x,this.y*t.y,this.z*t.z)};e.Vector3.prototype.divide=function(t){t=1/t;return new e.Vector3(this.x*t,this.y*t,this.z*t)};e.Vector3.prototype.normalize=function(){var e=this.x,t=this.y,n=this.z,e=e*e+t*t+n*n;e>0&&(e=1/Math.sqrt(e),this.x*=e,this.y*=e,this.z*=e)};e.Vector3.prototype.getMagnitude=function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)};e.Vector3.prototype.setMagnitude=function(e){this.normalize();this.x*=e;this.y*=e;this.z*=e};e.Vector3.prototype.toString=function(){return"["+this.x+" , "+this.y+" , "+this.z+"]"};e.Vector3.prototype.sum=function(e,t){return e.add(t)};e.Vector3.prototype.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z};e.Vector3.prototype.cross=function(t,n){var r=t.x,i=t.y,s=t.z,o=n.x,u=n.y,f=n.z;return new e.Vector3(i*f-s*u,s*o-r*f,r*u-i*o)};e.Vector3.prototype.distance=function(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.z-t.z;return Math.sqrt(n*n+r*r+i*i)}})(MOD3);(function(e){e.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1;if(typeof e!="undefined")this.n11=e;if(typeof t!="undefined")this.n12=t;if(typeof n!="undefined")this.n13=n;if(typeof r!="undefined")this.n14=r;if(typeof i!="undefined")this.n21=i;if(typeof s!="undefined")this.n22=s;if(typeof o!="undefined")this.n23=o;if(typeof u!="undefined")this.n24=u;if(typeof a!="undefined")this.n31=a;if(typeof f!="undefined")this.n32=f;if(typeof l!="undefined")this.n33=l;if(typeof c!="undefined")this.n34=c;if(typeof h!="undefined")this.n41=h;if(typeof p!="undefined")this.n42=p;if(typeof d!="undefined")this.n43=d;if(typeof v!="undefined")this.n44=v};e.Matrix4.prototype.translationMatrix=function(e,t,n){this.n14=e;this.n24=t;this.n34=n;return this};e.Matrix4.prototype.scaleMatrix=function(e,t,n){this.n11=e;this.n22=t;this.n33=n;return this};e.Matrix4.prototype.rotationMatrix=function(e,t,n,r){var i=Math.cos(r),s=Math.sin(r),r=1-i,o=e*t*r,u=t*n*r,a=e*n*r,f=s*n,l=s*t;s*=e;this.n11=i+e*e*r;this.n12=-f+o;this.n13=l+a;this.n14=0;this.n21=f+o;this.n22=i+t*t*r;this.n23=-s+u;this.n24=0;this.n31=-l+a;this.n32=s+u;this.n33=i+n*n*r;this.n34=0;return this};e.Matrix4.prototype.calculateMultiply=function(e,t){var n=e.n11,r=t.n11,i=e.n21,s=t.n21,o=e.n31,u=t.n31,a=e.n12,f=t.n12,l=e.n22,c=t.n22,h=e.n32,p=t.n32,d=e.n13,v=t.n13,m=e.n23,g=t.n23,y=e.n33,b=t.n33,w=e.n14,E=t.n14,S=e.n24,x=t.n24,T=e.n34,N=t.n34;this.n11=n*r+a*s+d*u;this.n12=n*f+a*c+d*p;this.n13=n*v+a*g+d*b;this.n14=n*E+a*x+d*N+w;this.n21=i*r+l*s+m*u;this.n22=i*f+l*c+m*p;this.n23=i*v+l*g+m*b;this.n24=i*E+l*x+m*N+S;this.n31=o*r+h*s+y*u;this.n32=o*f+h*c+y*p;this.n33=o*v+h*g+y*b;this.n34=o*E+h*x+y*N+T};e.Matrix4.prototype.multiply=function(e,t){this.calculateMultiply(e,t);return this};e.Matrix4.prototype.multiplyVector=function(e,t){var n=t.x,r=t.y,i=t.z;t.x=n*e.n11+r*e.n12+i*e.n13+e.n14;t.y=n*e.n21+r*e.n22+i*e.n23+e.n24;t.z=n*e.n31+r*e.n32+i*e.n33+e.n34}})(MOD3);(function(e){e.VertexProxy=function(e){this.originalZ=this.originalY=this.originalX=this.ratioZ=this.ratioY=this.ratioX=null;if(typeof e!="undefined")this.vertex=e};e.VertexProxy.prototype.setVertex=function(){};e.VertexProxy.prototype.setRatios=function(e,t,n){this.ratioX=e;this.ratioY=t;this.ratioZ=n};e.VertexProxy.prototype.setOriginalPosition=function(e,t,n){this.originalX=e;this.originalY=t;this.originalZ=n};e.VertexProxy.prototype.getX=function(){};e.VertexProxy.prototype.getY=function(){};e.VertexProxy.prototype.getZ=function(){};e.VertexProxy.prototype.setX=function(){};e.VertexProxy.prototype.setY=function(){};e.VertexProxy.prototype.setZ=function(){};e.VertexProxy.prototype.getValue=function(t){switch(t){case e.ModConstant.X:return this.getX();case e.ModConstant.Y:return this.getY();case e.ModConstant.Z:return this.getZ()}return 0};e.VertexProxy.prototype.setValue=function(t,n){switch(t){case e.ModConstant.X:this.setX(n);break;case e.ModConstant.Y:this.setY(n);break;case e.ModConstant.Z:this.setZ(n)}};e.VertexProxy.prototype.getRatio=function(t){switch(t){case e.ModConstant.X:return this.ratioX;case e.ModConstant.Y:return this.ratioY;case e.ModConstant.Z:return this.ratioZ}return-1};e.VertexProxy.prototype.getOriginalValue=function(t){switch(t){case e.ModConstant.X:return this.originalX;case e.ModConstant.Y:return this.originalY;case e.ModConstant.Z:return this.originalZ}return 0};e.VertexProxy.prototype.reset=function(){this.setX(this.originalX);this.setY(this.originalY);this.setZ(this.originalZ)};e.VertexProxy.prototype.collapse=function(){this.originalX=this.getX();this.originalY=this.getY();this.originalZ=this.getZ()};e.VertexProxy.prototype.getVector=function(){return new e.Vector3(this.getX(),this.getY(),this.getZ())};e.VertexProxy.prototype.setVector=function(e){this.setX(e.x);this.setY(e.y);this.setZ(e.z)};e.VertexProxy.prototype.getRatioVector=function(){return new e.Vector3(this.ratioX,this.ratioY,this.ratioZ)}})(MOD3);(function(e){e.FaceProxy=function(){this.vertices=[]};e.FaceProxy.prototype.addVertex=function(e){this.vertices.push(e)};e.FaceProxy.prototype.getVertices=function(){return this.vertices}})(MOD3);(function(e){e.MeshProxy=function(){this.depth=this.height=this.width=this.minAxis=this.midAxis=this.maxAxis=this.minZ=this.minY=this.minX=this.maxZ=this.maxY=this.maxX=null;this.vertices=[];this.faces=[];this.mesh=null};e.MeshProxy.prototype.getVertices=function(){return this.vertices};e.MeshProxy.prototype.getFaces=function(){return this.faces};e.MeshProxy.prototype.analyzeGeometry=function(){for(var t=this.getVertices(),n=t.length,r=n,i,s,o,u,f,l,c,h,p,d,v=!0,m=Math.min,g=Math.max;--r>=0;)i=t[r],s=i.getX(),o=i.getY(),u=i.getZ(),v?(f=l=s,c=h=o,p=d=u,v=!1):(f=m(f,s),c=m(c,o),p=m(p,u),l=g(l,s),h=g(h,o),d=g(d,u)),i.setOriginalPosition(s,o,u);s=l-f;o=h-c;depth=d-p;this.width=s;this.height=o;this.depth=depth;this.minX=f;this.maxX=l;this.minY=c;this.maxY=h;this.minZ=p;this.maxZ=d;r=g(s,g(o,depth));m=m(s,m(o,depth));if(r==s&&m==o)this.minAxis=e.ModConstant.Y,this.midAxis=e.ModConstant.Z,this.maxAxis=e.ModConstant.X;else if(r==s&&m==depth)this.minAxis=e.ModConstant.Z,this.midAxis=e.ModConstant.Y,this.maxAxis=e.ModConstant.X;else if(r==o&&m==s)this.minAxis=e.ModConstant.X,this.midAxis=e.ModConstant.Z,this.maxAxis=e.ModConstant.Y;else if(r==o&&m==depth)this.minAxis=e.ModConstant.Z,this.midAxis=e.ModConstant.X,this.maxAxis=e.ModConstant.Y;else if(r==depth&&m==s)this.minAxis=e.ModConstant.X,this.midAxis=e.ModConstant.Y,this.maxAxis=e.ModConstant.Z;else if(r==depth&&m==o)this.minAxis=e.ModConstant.Y,this.midAxis=e.ModConstant.X,this.maxAxis=e.ModConstant.Z;for(r=n;--r>=0;)i=t[r],i.setRatios((i.getX()-f)/s,(i.getY()-c)/o,(i.getZ()-p)/depth)};e.MeshProxy.prototype.resetGeometry=function(){for(var e=this.getVertices(),t=e.length;--t>=0;)e[t].reset()};e.MeshProxy.prototype.collapseGeometry=function(){for(var e=this.getVertices(),t=e.length;--t>=0;)e[t].collapse();this.analyzeGeometry()};e.MeshProxy.prototype.getMin=function(t){switch(t){case e.ModConstant.X:return this.minX;case e.ModConstant.Y:return this.minY;case e.ModConstant.Z:return this.minZ}return-1};e.MeshProxy.prototype.getMax=function(t){switch(t){case e.ModConstant.X:return this.maxX;case e.ModConstant.Y:return this.maxY;case e.ModConstant.Z:return this.maxZ}return-1};e.MeshProxy.prototype.getSize=function(t){switch(t){case e.ModConstant.X:return this.width;case e.ModConstant.Y:return this.height;case e.ModConstant.Z:return this.depth}return-1};e.MeshProxy.prototype.setMesh=function(e){this.mesh=e;this.vertices=[];this.faces=[]};e.MeshProxy.prototype.postApply=function(){};e.MeshProxy.prototype.updateMeshPosition=function(){}})(MOD3);(function(e){e.Modifier=function(){this.mod=null};e.Modifier.prototype.setModifiable=function(e){this.mod=e};e.Modifier.prototype.getVertices=function(){return this.mod.getVertices()};e.Modifier.prototype.apply=function(){}})(MOD3);(function(e){e.Library3d=function(){this.id="";this.vertexClass=this.meshClass=null}})(MOD3);(function(e){e.PluginFactory={};e.PluginFactory.getMeshProxy=function(e){return new e.meshClass}})(MOD3);(function(e){e.ModifierStack=function(t,n){this.lib3d=t;this.stack=this.baseMesh=null;this.baseMesh=e.PluginFactory.getMeshProxy(t);this.baseMesh.setMesh(n);this.baseMesh.analyzeGeometry();this.stack=[]};e.ModifierStack.prototype.addModifier=function(e){e.setModifiable(this.baseMesh);this.stack.push(e)};e.ModifierStack.prototype.apply=function(){this.baseMesh.resetGeometry();for(var e=this.stack,t=e.length,n=0;n<t;)e[n++].apply();this.baseMesh.postApply()};e.ModifierStack.prototype.collapse=function(){this.apply();this.baseMesh.collapseGeometry();this.stack=[]};e.ModifierStack.prototype.clear=function(){this.stack=[]};e.ModifierStack.prototype.getMeshInfo=function(){return this.baseMesh}})(MOD3);(function(e){e.Pivot=function(t,n,r){this.pivot=new e.Vector3(t,n,r)};e.Pivot.prototype=new e.Modifier;e.Pivot.prototype.constructor=e.Pivot;e.Pivot.prototype.setMeshCenter=function(){var t=this.mod;this.pivot=new e.Vector3(-(t.minX+.5*t.width),-(t.minY+.5*t.height),-(t.minZ+.5*t.depth))};e.Pivot.prototype.apply=function(){for(var e=this.mod.getVertices(),t=e.length,n=this.pivot,r,i;--t>=0;)r=e[t],i=r.getVector().clone(),r.setVector(i.add(n));this.mod.updateMeshPosition(n.clone().negate())}})(MOD3);(function(e){e.Bend=function(t,n,r){this.diagAngle=this.angle=this.offset=this.force=null;this.constraint=e.ModConstant.NONE;this.m2=this.m1=this.origin=this.height=this.width=this.mid=this.min=this.max=null;this.switchAxes=!1;this.force=t;this.offset=n;this.setAngle(r)};e.Bend.prototype=new e.Modifier;e.Bend.prototype.constructor=e.Bend;e.Bend.prototype.setAngle=function(t){this.angle=t;this.m1=new e.Matrix;this.m1.rotate(t);this.m2=new e.Matrix;this.m2.rotate(-t)};e.Bend.prototype.setModifiable=function(t){e.Modifier.prototype.setModifiable.call(this,t);this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis;this.min=this.mod.minAxis;this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis;this.width=this.mod.getSize(this.max);this.height=this.mod.getSize(this.mid);this.origin=this.mod.getMin(this.max);this.diagAngle=Math.atan(this.width/this.height)};e.Bend.prototype.apply=function(){if(this.force!=0)for(var t=this.mod.getVertices(),n=t.length,r=this.width,i=this.offset,s=this.origin,o=this.max,u=this.min,f=this.mid,l=this.m1,c=this.m2,h=s+r*i,p=r/Math.PI/this.force,d=e.Constants.doublePI*(r/(p*e.Constants.doublePI)),v,m,g,y,b=1/r,w=e.Constants.halfPI,E=Math.sin,S=Math.cos;--n>=0;)r=t[n],v=r.getValue(o),m=r.getValue(f),g=r.getValue(u),m=l.transformPoint(new e.Point(v,m)),v=m.x,m=m.y,y=(v-s)*b,this.constraint==e.ModConstant.LEFT&&y<=i||this.constraint==e.ModConstant.RIGHT&&y>=i||(y=w-d*i+d*y,v=E(y)*(p+g),y=S(y)*(p+g),g=v-p,v=h-y),m=c.transformPoint(new e.Point(v,m)),v=m.x,m=m.y,r.setValue(o,v),r.setValue(f,m),r.setValue(u,g)}})(MOD3);(function(e){e.Bloat=function(){this.center=e.Vector3.ZERO();this.radius=0;this.a=.01;this.u=e.Vector3.ZERO()};e.Bloat.prototype=new e.Modifier;e.Bloat.prototype.constructor=e.Bloat;e.Bloat.prototype.setRadius=function(e){this.radius=Math.max(0,e)};e.Bloat.prototype.setA=function(e){this.a=Math.max(0,e)};e.Bloat.prototype.apply=function(){for(var e=this.mod.getVertices(),t=e.length,n=this.center,r=this.radius,i=this.a,s,o;--t>=0;)s=e[t],this.u.x=s.getX()-n.x,this.u.y=s.getY()-n.y,this.u.z=s.getZ()-n.z,o=this.u.getMagnitude(),this.u.setMagnitude(o+r*Math.exp(-o*i)),s.setX(this.u.x+n.x),s.setY(this.u.y+n.y),s.setZ(this.u.z+n.z)}})(MOD3);(function(e){e.Twist=function(t){this.vector=new e.Vector3(0,1,0);this.angle=t;this.center=e.Vector3.ZERO()};e.Twist.prototype=new e.Modifier;e.Twist.prototype.constructor=e.Twist;e.Twist.prototype.apply=function(){this.vector.normalize();for(var t=this.mod,n=t.getVertices(),r=n.length,i=this.vector,s=this.angle,o=this.center,t=1/(new e.Vector3(.5*t.maxX,.5*t.maxY,.5*t.maxZ)).getMagnitude()*s,o=-e.Vector3.dot(i,o),u;--r>=0;)s=n[r],u=s.getX()*i.x+s.getY()*i.y+s.getZ()*i.z+o,this.twistPoint(s,u*t)};e.Twist.prototype.twistPoint=function(t,n){var r=(new e.Matrix4).translationMatrix(t.getX(),t.getY(),t.getZ()),r=(new e.Matrix4).multiply((new e.Matrix4).rotationMatrix(this.vector.x,this.vector.y,this.vector.z,n),r);t.setX(r.n14);t.setY(r.n24);t.setZ(r.n34)}})(MOD3);(function(e){e.Skew=function(t){this.force=0;this.skewAxis=null;if(typeof t!="undefined")this.force=t;this.offset=.5;this.constraint=e.ModConstant.NONE;this.falloff=this.power=1;this.swapAxes=this.oneSide=this.inverseFalloff=!1};e.Skew.prototype=new e.Modifier;e.Skew.prototype.constructor=e.Skew;e.Skew.prototype.setModifiable=function(t){e.Modifier.prototype.setModifiable.call(this,t);this.skewAxis=this.skewAxis||this.mod.maxAxis};e.Skew.prototype.apply=function(){for(var t=this.mod.getVertices(),n=t.length,r=this.constraint,i=this.skewAxis,s=this.offset,o=this.oneSide,u=this.inverseFalloff,f=this.falloff,l=1-f,c=this.power,h=this.force,p=this.getDisplaceAxis(),d,v,m;--n>=0;)d=t[n],!(r==e.ModConstant.LEFT&&d.getRatio(i)<=s)&&!(r==e.ModConstant.RIGHT&&d.getRatio(i)>s)&&(v=d.getRatio(i)-s,o&&(v=Math.abs(v)),m=d.getRatio(p),u&&(m=1-m),m=f+m*l,v=Math.pow(Math.abs(v),c)*e.XMath.sign(v,1),v=d.getValue(p)+h*v*m,d.setValue(p,v))};e.Skew.prototype.getDisplaceAxis=function(){switch(this.skewAxis){case e.ModConstant.X:return this.swapAxes?e.ModConstant.Z:e.ModConstant.Y;case e.ModConstant.Y:return this.swapAxes?e.ModConstant.Z:e.ModConstant.X;case e.ModConstant.Z:return this.swapAxes?e.ModConstant.Y:e.ModConstant.X;default:return 0}}})(MOD3);(function(e){e.Taper=function(t){this.power=this.force=null;this.start=0;this.end=1;this.vector=new e.Vector3(1,0,1);this.vector2=new e.Vector3(0,1,0);if(typeof t!="undefined")this.force=t;this.power=1};e.Taper.prototype=new e.Modifier;e.Taper.prototype.constructor=e.Taper;e.Taper.prototype.setFalloff=function(e,t){this.start=0;this.end=1;if(typeof e!="undefined")this.start=e;if(typeof t!="undefined")this.end=t};e.Taper.prototype.apply=function(){for(var t=this.mod.getVertices(),n=t.length,r=this.vector,i=this.vector2,s=this.force,o=this.power,u,f,l;--n>=0;)u=t[n],f=u.getRatioVector().multiply(i),f=s*Math.pow(f.getMagnitude(),o),f=(new e.Matrix4).scaleMatrix(1+f*r.x,1+f*r.y,1+f*r.z),l=u.getVector(),(new e.Matrix4).multiplyVector(f,l),u.setVector(l)}})(MOD3);(function(e){e.Wheel=function(){this.radius=this.roll=this.turn=this.speed=null;this.steerVector=new e.Vector3(0,1,0);this.rollVector=new e.Vector3(0,0,1);this.roll=this.turn=this.speed=0};e.Wheel.prototype=new e.Modifier;e.Wheel.prototype.constructor=e.Wheel;e.Wheel.prototype.setModifiable=function(t){e.Modifier.prototype.setModifiable.call(this,t);this.radius=.5*this.mod.width};e.Wheel.prototype.apply=function(){this.roll+=this.speed;var t=this.mod.getVertices(),n=t.length,r=this.steerVector,i=this.turn,s=this.rollVector,o=this.roll,u;0!=i?(u=(new e.Matrix4).rotationMatrix(r.x,r.y,r.z,i),r=s.clone(),(new e.Matrix4).multiplyVector(u,r),o=(new e.Matrix4).rotationMatrix(r.x,r.y,r.z,o)):o=(new e.Matrix4).rotationMatrix(s.x,s.y,s.z,o);for(;--n>=0;)r=t[n],s=r.getVector().clone(),0!=i&&(new e.Matrix4).multiplyVector(u,s),(new e.Matrix4).multiplyVector(o,s),r.setX(s.x),r.setY(s.y),r.setZ(s.z)};e.Wheel.prototype.getStep=function(){return this.radius*this.speed*e.Constants.invPI};e.Wheel.prototype.getPerimeter=function(){return this.radius*e.Constants.doublePI}})(MOD3);(function(e){e.Break=function(t,n){this.bv=new e.Vector3(0,1,0);this.angle=this.offset=0;if(typeof t!="undefined")this.offset=t;if(typeof n!="undefined")this.angle=n;this.range=new e.Range(0,1)};e.Break.prototype=new e.Modifier;e.Break.prototype.constructor=e.Break;e.Break.prototype.apply=function(){var t=this.mod,n=t.getVertices(),r=n.length,i=this.range,s=this.angle,o=this.bv,u,f,t=new e.Vector3(0,0,-(t.minZ+t.depth*this.offset));u=t.negate();for(f=(new e.Matrix4).rotationMatrix(o.x,o.y,o.z,s);--r>=0;)s=n[r],o=s.getVector(),o=o.add(t),o.z>=0&&i.isIn(s.ratioY)&&(new e.Matrix4).multiplyVector(f,o),o=o.add(u),s.setX(o.x),s.setY(o.y),s.setZ(o.z)}})(MOD3);(function(e){e.Noise=function(t){this.force=0;this.axc=e.ModConstant.NONE;this.end=this.start=0;if(typeof t!="undefined")this.force=t};e.Noise.prototype=new e.Modifier;e.Noise.prototype.constructor=e.Noise;e.Noise.prototype.constraintAxes=function(e){this.axc=e};e.Noise.prototype.setFalloff=function(e,t){this.start=0;this.end=1;if(typeof e!="undefined")this.start=e;if(typeof t!="undefined")this.end=t};e.Noise.prototype.apply=function(){for(var e=this.mod,t=this.axc,n=this.start,r=this.end,i=e.getVertices(),s=i.length,o=this.force,u=.5*o,a=Math.random,f,l,c;--s>=0;)f=i[s],l=a()*o-u,c=f.getRatio(e.maxAxis),n<r?(c<n&&(c=0),c>r&&(c=1)):n>r?(c=1-c,c>n&&(c=0),c<r&&(c=1)):c=1,t&1||f.setX(f.getX()+l*c),t>>1&1||f.setY(f.getY()+l*c),t>>2&1||f.setZ(f.getZ()+l*c)}})(MOD3);(function(e){e.LibraryThree=function(){this.id="Three.js";this.meshClass=e.MeshThree;this.vertexClass=e.VertexThree};e.LibraryThree.prototype=new e.Library3d;e.LibraryThree.prototype.constructor=e.LibraryThree})(MOD3);(function(e){e.VertexThree=function(e){this.mesh=e};e.VertexThree.prototype=new e.VertexProxy;e.VertexThree.prototype.setVertex=function(e){this.vertex=e;this.originalX=e.x;this.originalY=e.y;this.originalZ=e.z};e.VertexThree.prototype.getX=function(){return this.vertex.x};e.VertexThree.prototype.getY=function(){return this.vertex.y};e.VertexThree.prototype.getZ=function(){return this.vertex.z};e.VertexThree.prototype.setX=function(e){this.vertex.x=e;e=this.mesh;e.geometry.verticesNeedUpdate=!0;e.geometry.normalsNeedUpdate=!0;e.geometry.buffersNeedUpdate=!0;e.geometry.dynamic=!0};e.VertexThree.prototype.setY=function(e){this.vertex.y=e;e=this.mesh;e.geometry.verticesNeedUpdate=!0;e.geometry.normalsNeedUpdate=!0;e.geometry.buffersNeedUpdate=!0;e.geometry.dynamic=!0};e.VertexThree.prototype.setZ=function(e){this.vertex.z=e;e=this.mesh;e.geometry.verticesNeedUpdate=!0;e.geometry.normalsNeedUpdate=!0;e.geometry.buffersNeedUpdate=!0;e.geometry.dynamic=!0}})(MOD3);(function(e){e.MeshThree=function(){};e.MeshThree.prototype=new e.MeshProxy;e.MeshThree.prototype.setMesh=function(t){e.MeshProxy.prototype.setMesh.call(this,t);for(var t=[],n=0,r=this.mesh.geometry.vertices,i=r.length,s=this.mesh.geometry.faces,o=s.length,u,n=0;n<i;)u=new e.VertexThree(this.mesh),u.setVertex(r[n]),this.vertices.push(u),t[r[n]]=u,n++;for(n=0;n<o;)i=new e.FaceProxy,s[n]instanceof THREE.Face3?(i.addVertex(t[r[s[n].a]]),i.addVertex(t[r[s[n].b]]),i.addVertex(t[r[s[n].c]])):s[n]instanceof THREE.Face4&&(i.addVertex(t[r[s[n].a]]),i.addVertex(t[r[s[n].b]]),i.addVertex(t[r[s[n].c]]),i.addVertex(t[r[s[n].d]])),this.faces.push(i),n++;delete lookup};e.MeshThree.prototype.updateMeshPosition=function(e){var t=this.mesh;t.position.x+=e.x;t.position.y+=e.y;t.position.z+=e.z}})(MOD3);(function(e){e.LibraryPre3D=function(){this.id="pre3d.js";this.meshClass=e.MeshPre3D;this.vertexClass=e.VertexPre3D};e.LibraryThree.prototype=new e.Library3d;e.LibraryThree.prototype.constructor=e.LibraryPre3D})(MOD3);(function(e){e.VertexPre3D=function(){};e.VertexPre3D.prototype=new e.VertexProxy;e.VertexPre3D.prototype.setVertex=function(e){this.vertex=e;this.originalX=e.x;this.originalY=e.y;this.originalZ=e.z};e.VertexPre3D.prototype.getX=function(){return this.vertex.x};e.VertexPre3D.prototype.getY=function(){return this.vertex.y};e.VertexPre3D.prototype.getZ=function(){return this.vertex.z};e.VertexPre3D.prototype.setX=function(e){this.vertex.x=e};e.VertexPre3D.prototype.setY=function(e){this.vertex.y=e};e.VertexPre3D.prototype.setZ=function(e){this.vertex.z=e}})(MOD3);(function(e){e.MeshPre3D=function(){};e.MeshPre3D.prototype=new e.MeshProxy;e.MeshPre3D.prototype.setMesh=function(t){e.MeshProxy.prototype.setMesh.call(this,t);for(var t=[],n=this.mesh.vertices,r=this.mesh.quads,i=n.length,s=r.length,o=0;o<i;o++){var u=new e.VertexPre3D;u.setVertex(n[o]);this.vertices.push(u);t[n[o]]=u}for(o=0;o<s;o++)i=new e.FaceProxy,r[o]instanceof Pre3d.QuadFace&&(i.addVertex(t[n[r[o].i0]]),i.addVertex(t[n[r[o].i1]]),i.addVertex(t[n[r[o].i2]]),r[o].i3!=null&&i.addVertex(t[n[r[o].i3]])),this.faces.push(i);delete lookup};e.MeshPre3D.prototype.updateMeshPosition=function(){}})(MOD3);(function(e){e.LibraryJ3D=function(){this.id="J3D";this.meshClass=e.MeshJ3D;this.vertexClass=e.VertexJ3D};e.LibraryJ3D.prototype=new e.Library3d;e.LibraryJ3D.prototype.constructor=e.LibraryJ3D})(MOD3);(function(e){e.VertexJ3D=function(e){this.geometry=e};e.VertexJ3D.prototype=new e.VertexProxy;e.VertexJ3D.prototype.setVertex=function(e){this.vertex=e;var t=this.geometry;this.originalX=t.vertexPositionBuffer.data[e];this.originalY=t.vertexPositionBuffer.data[e+1];this.originalZ=t.vertexPositionBuffer.data[e+2]};e.VertexJ3D.prototype.getX=function(){return this.geometry.vertexPositionBuffer.data[this.vertex]};e.VertexJ3D.prototype.getY=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+1]};e.VertexJ3D.prototype.getZ=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+2]};e.VertexJ3D.prototype.setX=function(e){var t=this.geometry;t.vertexPositionBuffer.data[this.vertex]=e;t.replaceArray(t.vertexPositionBuffer,t.vertexPositionBuffer.data)};e.VertexJ3D.prototype.setY=function(e){var t=this.geometry;t.vertexPositionBuffer.data[this.vertex+1]=e;t.replaceArray(t.vertexPositionBuffer,t.vertexPositionBuffer.data)};e.VertexJ3D.prototype.setZ=function(e){var t=this.geometry;t.vertexPositionBuffer.data[this.vertex+2]=e;t.replaceArray(t.vertexPositionBuffer,t.vertexPositionBuffer.data)}})(MOD3);(function(e){e.MeshJ3D=function(){};e.MeshJ3D.prototype=new e.MeshProxy;e.MeshJ3D.prototype.setMesh=function(t){e.MeshProxy.prototype.setMesh.call(this,t);for(var n=0,r=t.geometry.vertexPositionBuffer.data.length,i=t.geometry.vertexPositionBuffer.itemSize,s,n=0;n<r;)s=new e.VertexJ3D(t.geometry),s.setVertex(n),this.vertices.push(s),n+=i;this.faces=null};e.MeshJ3D.prototype.updateMeshPosition=function(e){var t=this.mesh;t.position.x+=e.x;t.position.y+=e.y;t.position.z+=e.z}})(MOD3);(function(e){e.LibraryCopperlicht=function(){this.id="Copperlicht";this.meshClass=e.MeshCopperlicht;this.vertexClass=e.VertexCopperlicht};e.LibraryCopperlicht.prototype=new e.Library3d;e.LibraryCopperlicht.prototype.constructor=e.LibraryCopperlicht})(MOD3);(function(e){e.VertexCopperlicht=function(e,t){this.node=e;this.buffer=t};e.VertexCopperlicht.prototype=new e.VertexProxy;e.VertexCopperlicht.prototype.setVertex=function(e){this.vertex=e;this.originalX=this.vertex.Pos.X;this.originalY=this.vertex.Pos.Y;this.originalZ=this.vertex.Pos.Z};e.VertexCopperlicht.prototype.getX=function(){return this.vertex.Pos.X};e.VertexCopperlicht.prototype.getY=function(){return this.vertex.Pos.Y};e.VertexCopperlicht.prototype.getZ=function(){return this.vertex.Pos.Z};e.VertexCopperlicht.prototype.setX=function(e){this.vertex.Pos.X=e;this.buffer.update(!0)};e.VertexCopperlicht.prototype.setY=function(e){this.vertex.Pos.Y=e;this.buffer.update(!0)};e.VertexCopperlicht.prototype.setZ=function(e){this.vertex.Pos.Z=e;this.buffer.update(!0)}})(MOD3);(function(e){e.MeshCopperlicht=function(){};e.MeshCopperlicht.prototype=new e.MeshProxy;e.MeshCopperlicht.prototype.setMesh=function(t){e.MeshProxy.prototype.setMesh.call(this,t);for(var t=this.mesh.getMesh().GetMeshBuffers(),n=[],r=0;r<t.length;r++)for(var n=t[r].Vertices,i=n.length,s=0;s<i;s++){var o=new e.VertexCopperlicht(this.mesh,t[r]);o.setVertex(n[s]);this.vertices.push(o)}this.faces=null;delete lookup};e.MeshCopperlicht.prototype.updateMeshPosition=function(e){this.mesh.Pos.X+=e.x;this.mesh.Pos.Y+=e.y;this.mesh.Pos.Z+=e.z}})(MOD3)}