!function(f,h,w){f(function(){var u;function m(r,c,d,u,l){var t=document.createElement("a");return t.classList.add("suggestion-dismiss"),t.setAttribute("title",h.i18n_marketplace_suggestions_dismiss_tooltip),t.setAttribute("href","#"),t.onclick=function(t){var e,s,o,a,n,i;t.preventDefault(),t=r,e=c,s=d,o=u,f("[data-suggestion-slug="+(a=l)+"]").fadeOut(function(){f(this).remove(),p()}),jQuery.post(w,{action:"woocommerce_add_dismissed_marketplace_suggestion",_wpnonce:h.dismiss_suggestion_nonce,slug:a}),_.contains(["products-list-inline"],t)&&(Cookies.set("woocommerce_snooze_suggestions__"+t,"true",{expires:2}),n="woocommerce_dismissed_suggestions__"+t,i=parseInt(Cookies.get(n),10)||0,Cookies.set(n,i+1,{expires:31})),window.wcTracks.recordEvent("marketplace_suggestion_dismissed",{suggestion_slug:a,context:t,product:e||"",promoted:s||"",target:o||""})},t}function k(t,e,s,o,a,n,i){var r,c,d,u=document.createElement("a"),l=(r=t,d=a,(c=h.in_app_purchase_params).utm_source="unknown",c.utm_campaign="marketplacesuggestions",c.utm_medium="product",(l=_.findKey({productstable:["products-list-inline"],productsempty:["products-list-empty-header","products-list-empty-footer","products-list-empty-body"],ordersempty:["orders-list-empty-header","orders-list-empty-footer","orders-list-empty-body"],editproduct:["product-edit-meta-tab-header","product-edit-meta-tab-footer","product-edit-meta-tab-body"]},function(t){return _.contains(t,r)}))&&(c.utm_source=l),d+"?"+jQuery.param(c));u.setAttribute("href",l);return _.includes(["product-edit-meta-tab-header","product-edit-meta-tab-footer","product-edit-meta-tab-body","products-list-empty-footer"],t)&&u.setAttribute("target","blank"),u.textContent=n,u.onclick=function(){window.wcTracks.recordEvent("marketplace_suggestion_clicked",{suggestion_slug:o,context:t,product:e||"",promoted:s||"",target:a||""})},i?u.classList.add("button"):(u.classList.add("linkout"),(d=document.createElement("span")).classList.add("dashicons","dashicons-external"),u.appendChild(d)),u}function l(t,e,s,o,a,n,i,r,c,d,u){var l,p,g=document.createElement("div"),a=(g.classList.add("marketplace-suggestion-container"),g.dataset.suggestionSlug=o,(a=a)?((l=document.createElement("img")).src=a,l.classList.add("marketplace-suggestion-icon"),l):null);return a&&g.appendChild(a),g.appendChild((l=o,a=n,n=i,(i=document.createElement("div")).classList.add("marketplace-suggestion-container-content"),a&&((p=document.createElement("h4")).textContent=a,i.appendChild(p)),n&&((a=document.createElement("p")).textContent=n,i.appendChild(a)),-1!==["product-edit-empty-footer-browse-all","product-edit-meta-tab-footer-browse-all"].indexOf(l)&&(i.classList.add("has-manage-link"),(p=document.createElement("a")).classList.add("marketplace-suggestion-manage-link","linkout"),p.setAttribute("href",h.manage_suggestions_url),p.textContent=h.i18n_marketplace_suggestions_manage_suggestions,i.appendChild(p)),i)),g.appendChild((n=t,a=e,p=s,i=o,t=r,e=c,s=d,o=u,r=document.createElement("div"),e=e||h.i18n_marketplace_suggestions_default_cta,r.classList.add("marketplace-suggestion-container-cta"),t&&e&&(e=k(n,a,p,i,t,e,s),r.appendChild(e)),o&&r.appendChild(m(n,a,p,t,i)),r)),g}function p(){f('.marketplace-suggestions-container[data-marketplace-suggestions-context="product-edit-meta-tab-body"]').children().length<=0&&f('.marketplace-suggestions-container[data-marketplace-suggestions-context="product-edit-meta-tab-body"], .marketplace-suggestions-container[data-marketplace-suggestions-context="product-edit-meta-tab-header"], .marketplace-suggestions-container[data-marketplace-suggestions-context="product-edit-meta-tab-footer"]').fadeOut({complete:function(){f(".marketplace-suggestions-metabox-nosuggestions-placeholder").fadeIn()}})}function g(t){return _.includes(["product-edit-meta-tab-header","product-edit-meta-tab-body","product-edit-meta-tab-footer"],t)}function t(c){var t,d=[];f(".marketplace-suggestions-container").each(function(){var e,t,s=this.dataset.marketplaceSuggestionsContext,o=(o=c,e=s,o=_.filter(o,function(t){return _.isArray(t.context)?_.contains(t.context,e):e===t.context}),o=_.filter(o,function(t){return!_.contains(h.dismissed_suggestions,t.slug)}),o=_.filter(o,function(t){return!_.contains(h.active_plugins,t.product)}),_.filter(o,function(t){return!t["show-if-active"]||0<_.intersection(h.active_plugins,t["show-if-active"]).length})),a=_.sample(o,5);for(t in a){var n=a[t]["link-text"],i=!0,r=(a[t]["link-text"]&&(n=a[t]["link-text"],i=!1),!0),n=(!1===a[t]["allow-dismiss"]&&(r=!1),l(s,a[t].product,a[t].promoted,a[t].slug,a[t].icon,a[t].title,a[t].copy,a[t].url,n,i,r));f(this).append(n),f(this).addClass("showing-suggestion"),d.push(s),g(s)||window.wcTracks.recordEvent("marketplace_suggestion_displayed",{suggestion_slug:a[t].slug,context:s,product:a[t].product||"",promoted:a[t].promoted||"",target:a[t].url||""})}f("ul.product_data_tabs li.marketplace-suggestions_options a").on("click",function(t){if(t.preventDefault(),"#marketplace_suggestions"!==u&&g(s))for(var e in a)window.wcTracks.recordEvent("marketplace_suggestion_displayed",{suggestion_slug:a[e].slug,context:s,product:a[e].product||"",promoted:a[e].promoted||"",target:a[e].url||""})})}),t=d,(t=0<_.intersection(t,["products-list-empty-body","orders-list-empty-body"]).length)&&(f("#screen-meta-links").hide(),f("#wpfooter").hide()),t||(f('.marketplace-suggestions-container[data-marketplace-suggestions-context="products-list-empty-header"]').hide(),f('.marketplace-suggestions-container[data-marketplace-suggestions-context="products-list-empty-footer"]').hide(),f('.marketplace-suggestions-container[data-marketplace-suggestions-context="orders-list-empty-header"]').hide(),f('.marketplace-suggestions-container[data-marketplace-suggestions-context="orders-list-empty-footer"]').hide()),p()}void 0!==h&&(window.wcTracks=window.wcTracks||{},window.wcTracks.recordEvent=window.wcTracks.recordEvent||function(){},u=!1,h.suggestions_data&&(t(h.suggestions_data),f("ul.product_data_tabs").on("click","li a",function(t){t.preventDefault(),u=f(this).attr("href")})),f("a.marketplace-suggestion-manage-link").on("click",function(){window.wcTracks.recordEvent("marketplace_suggestions_manage_clicked")}))})}(jQuery,marketplace_suggestions,ajaxurl);