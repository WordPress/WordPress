"use strict";var wp;(wp||={}).uploadMedia=(()=>{var je=Object.create;var B=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var Xe=Object.getOwnPropertyNames;var Ke=Object.getPrototypeOf,Ze=Object.prototype.hasOwnProperty;var Je=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var E=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),T=(e,t)=>{for(var r in t)B(e,r,{get:t[r],enumerable:!0})},pe=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Xe(t))!Ze.call(e,n)&&n!==r&&B(e,n,{get:()=>t[n],enumerable:!(o=Ye(t,n))||o.enumerable});return e};var U=(e,t,r)=>(r=e!=null?je(Ke(e)):{},pe(t||!e||!e.__esModule?B(r,"default",{value:e,enumerable:!0}):r,e)),et=e=>pe(B({},"__esModule",{value:!0}),e);var N=E((ir,le)=>{le.exports=window.wp.data});var Ie=E((Rr,ge)=>{ge.exports=window.wp.url});var x=E((Er,ye)=>{ye.exports=window.wp.i18n});var Ce=E(($r,Ae)=>{Ae.exports=window.wp.blob});var xe=E((to,Te)=>{Te.exports=window.wp.privateApis});var ie=E((uo,Be)=>{Be.exports=window.wp.element});var qe=E((po,Ne)=>{Ne.exports=window.wp.compose});var ae=E((lo,ze)=>{ze.exports=window.ReactJSXRuntime});var or={};T(or,{MediaUploadProvider:()=>$e,UploadError:()=>h,clearFeatureDetectionCache:()=>Ve,detectClientSideMediaSupport:()=>se,isClientSideMediaSupported:()=>He,store:()=>_});var O=U(N(),1);var a=(e=>(e.Unknown="REDUX_UNKNOWN",e.Add="ADD_ITEM",e.Prepare="PREPARE_ITEM",e.Cancel="CANCEL_ITEM",e.Remove="REMOVE_ITEM",e.RetryItem="RETRY_ITEM",e.PauseItem="PAUSE_ITEM",e.ResumeItem="RESUME_ITEM",e.PauseQueue="PAUSE_QUEUE",e.ResumeQueue="RESUME_QUEUE",e.OperationStart="OPERATION_START",e.OperationFinish="OPERATION_FINISH",e.AddOperations="ADD_OPERATIONS",e.CacheBlobUrl="CACHE_BLOB_URL",e.RevokeBlobUrls="REVOKE_BLOB_URLS",e.UpdateProgress="UPDATE_PROGRESS",e.UpdateSettings="UPDATE_SETTINGS",e))(a||{}),b=(e=>(e.Queued="QUEUED",e.Processing="PROCESSING",e.Paused="PAUSED",e.Uploaded="UPLOADED",e.Error="ERROR",e))(b||{}),p=(e=>(e.Prepare="PREPARE",e.Upload="UPLOAD",e.ResizeCrop="RESIZE_CROP",e.Rotate="ROTATE",e.TranscodeImage="TRANSCODE_IMAGE",e.ThumbnailGeneration="THUMBNAIL_GENERATION",e))(p||{});var q="core/upload-media",ce=5,de=2,me=["image/jpeg","image/png","image/gif","image/webp","image/avif"];var tt=()=>{},rt={queue:[],queueStatus:"active",blobUrls:{},settings:{mediaUpload:tt,maxConcurrentUploads:ce,maxConcurrentImageProcessing:de}};function ot(e=rt,t={type:a.Unknown}){switch(t.type){case a.PauseQueue:return{...e,queueStatus:"paused"};case a.ResumeQueue:return{...e,queueStatus:"active"};case a.PauseItem:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,status:b.Paused}:r)};case a.ResumeItem:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,status:b.Processing}:r)};case a.Add:return{...e,queue:[...e.queue,t.item]};case a.Cancel:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,error:t.error}:r)};case a.RetryItem:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,status:b.Processing,error:void 0,retryCount:(r.retryCount??0)+1}:r)};case a.Remove:return{...e,queue:e.queue.filter(r=>r.id!==t.id)};case a.OperationStart:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,currentOperation:t.operation}:r)};case a.AddOperations:return{...e,queue:e.queue.map(r=>r.id!==t.id?r:{...r,operations:[...r.operations||[],...t.operations]})};case a.OperationFinish:return{...e,queue:e.queue.map(r=>{if(r.id!==t.id)return r;let o=r.operations?r.operations.slice(1):[],n=r.attachment||t.item.attachment?{...r.attachment,...t.item.attachment}:void 0;return{...r,currentOperation:void 0,operations:o,...t.item,attachment:n,additionalData:{...r.additionalData,...t.item.additionalData}}})};case a.CacheBlobUrl:{let r=e.blobUrls[t.id]||[];return{...e,blobUrls:{...e.blobUrls,[t.id]:[...r,t.blobUrl]}}}case a.RevokeBlobUrls:{let r={...e.blobUrls};return delete r[t.id],{...e,blobUrls:r}}case a.UpdateProgress:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,progress:t.progress}:r)};case a.UpdateSettings:return{...e,settings:{...e.settings,...t.settings}}}return e}var Y=ot;var z={};T(z,{getItems:()=>nt,getSettings:()=>ut,isUploading:()=>it,isUploadingById:()=>st,isUploadingByUrl:()=>at});function nt(e){return e.queue}function it(e){return e.queue.length>=1}function at(e,t){return e.queue.some(r=>r.attachment?.url===t||r.sourceUrl===t)}function st(e,t){return e.queue.some(r=>r.attachment?.id===t||r.sourceAttachmentId===t)}function ut(e){return e.settings}var X={};T(X,{getActiveImageProcessingCount:()=>Ut,getActiveUploadCount:()=>It,getAllItems:()=>pt,getBlobUrls:()=>gt,getFailedItems:()=>vt,getItem:()=>lt,getItemProgress:()=>bt,getPausedUploadForPost:()=>mt,getPendingImageProcessing:()=>ht,getPendingUploads:()=>yt,hasPendingItemsByParentId:()=>wt,isBatchUploaded:()=>ct,isPaused:()=>ft,isUploadingToPost:()=>dt});function pt(e){return e.queue}function lt(e,t){return e.queue.find(r=>r.id===t)}function ct(e,t){return e.queue.filter(o=>t===o.batchId).length===0}function dt(e,t){return e.queue.some(r=>r.currentOperation===p.Upload&&r.additionalData.post===t)}function mt(e,t){return e.queue.find(r=>r.status===b.Paused&&r.additionalData.post===t)}function ft(e){return e.queueStatus==="paused"}function gt(e,t){return e.blobUrls[t]||[]}function It(e){return e.queue.filter(t=>t.currentOperation===p.Upload).length}function yt(e){return e.queue.filter(t=>(Array.isArray(t.operations?.[0])?t.operations[0][0]:t.operations?.[0])===p.Upload&&t.currentOperation!==p.Upload)}function Ut(e){return e.queue.filter(t=>t.currentOperation===p.ResizeCrop||t.currentOperation===p.Rotate).length}function ht(e){return e.queue.filter(t=>{let r=Array.isArray(t.operations?.[0])?t.operations[0][0]:t.operations?.[0];return(r===p.ResizeCrop||r===p.Rotate)&&t.currentOperation!==p.ResizeCrop&&t.currentOperation!==p.Rotate})}function vt(e){return e.queue.filter(t=>t.error!==void 0)}function wt(e,t){return e.queue.some(r=>r.parentId===t)}function bt(e,t){return e.queue.find(o=>o.id===t)?.progress}var H={};T(H,{addItems:()=>At,cancelItem:()=>Ct,retryItem:()=>Ot});var k,Rt=new Uint8Array(16);function K(){if(!k&&(k=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!k))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(Rt)}var I=[];for(let e=0;e<256;++e)I.push((e+256).toString(16).slice(1));function fe(e,t=0){return I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]}var Et=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Z={randomUUID:Et};function St(e,t,r){if(Z.randomUUID&&!t&&!e)return Z.randomUUID();e=e||{};let o=e.random||(e.rng||K)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){r=r||0;for(let n=0;n<16;++n)t[r+n]=o[n];return t}return fe(o)}var S=St;var J=class extends File{width=0;height=0;originalWidth=0;originalHeight=0;get wasResized(){return(this.originalWidth||0)>this.width||(this.originalHeight||0)>this.height}constructor(e,t,r,o,n){super([e],e.name,{type:e.type,lastModified:e.lastModified}),this.width=t,this.height=r,this.originalWidth=o,this.originalHeight=n}};var _t=U(Ie(),1),Pt=U(x(),1);function Ue(e){if(e instanceof File)return e;if("name"in e&&typeof e.name=="string")return new File([e],e.name,{type:e.type,lastModified:e.lastModified});let t=e.type.split("/")[1],r=e.type==="application/pdf"?"document":e.type.split("/")[0];return new File([e],`${r}.${t}`,{type:e.type})}function L(e,t){return new File([e],t,{type:e.type,lastModified:e.lastModified})}function ee(e){return L(e,e.name)}function W(e){return e.includes(".")?e.split(".").slice(0,-1).join("."):e}var te,M;function G(){return te||(te=import("@wordpress/vips/worker").then(e=>(M=e,e))),te}async function he(e,t,r,o,n){let{vipsConvertImageFormat:i}=await G(),s=await i(e,await t.arrayBuffer(),t.type,r,o,n),u=r.split("/")[1],l=`${W(t.name)}.${u}`;return new File([new Blob([s])],l,{type:r})}async function ve(e){let{vipsHasTransparency:t}=await G(),r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch image: ${r.status}`);return t(await r.arrayBuffer())}async function we(e,t,r,o,n,i,s){if(i?.aborted)throw new Error("Operation aborted");let{vipsResizeImage:u}=await G(),{buffer:l,width:d,height:c,originalWidth:g,originalHeight:m}=await u(e,await t.arrayBuffer(),t.type,r,o),y=t.name;if(g>d||m>c){let w=W(t.name);s?y=t.name.replace(w,`${w}-scaled`):n&&(y=t.name.replace(w,`${w}-${d}x${c}`))}return new J(new File([new Blob([l],{type:t.type})],y,{type:t.type}),d,c,g,m)}async function re(e,t,r,o){if(o?.aborted)throw new Error("Operation aborted");if(r===1)return t;let{vipsRotateImage:n}=await G(),{buffer:i,width:s,height:u}=await n(e,await t.arrayBuffer(),t.type,r),l=W(t.name),d=t.name.replace(l,`${l}-rotated`);return new J(new File([new Blob([i],{type:t.type})],d,{type:t.type}),s,u)}async function be(e){return M?M.vipsCancelOperations(e):!1}function Re(){M&&M.terminateVipsWorker()}var Q=U(x(),1);var h=class extends Error{code;file;constructor({code:e,message:t,file:r,cause:o}){super(t,{cause:o}),Object.setPrototypeOf(this,new.target.prototype),this.code=e,this.file=r}};function Ee(e,t){if(!t)return;let r=t.some(o=>o.includes("/")?o===e.type:e.type.startsWith(`${o}/`));if(e.type&&!r)throw new h({code:"MIME_TYPE_NOT_SUPPORTED",message:(0,Q.sprintf)((0,Q.__)("%s: Sorry, this file type is not supported here."),e.name),file:e})}var $=U(x(),1);function Se(e){return e?Object.entries(e).flatMap(([t,r])=>{let[o]=r.split("/"),n=t.split("|");return[r,...n.map(i=>`${o}/${i}`)]}):null}function _e(e,t){let r=Se(t);if(!r)return;let o=r.includes(e.type);if(e.type&&!o)throw new h({code:"MIME_TYPE_NOT_ALLOWED_FOR_USER",message:(0,$.sprintf)((0,$.__)("%s: Sorry, you are not allowed to upload this file type."),e.name),file:e})}var C=U(x(),1);function Pe(e,t){if(e.size<=0)throw new h({code:"EMPTY_FILE",message:(0,C.sprintf)((0,C.__)("%s: This file is empty."),e.name),file:e});if(t&&e.size>t)throw new h({code:"SIZE_ABOVE_LIMIT",message:(0,C.sprintf)((0,C.__)("%s: This file exceeds the maximum upload size for this site."),e.name),file:e})}function At({files:e,onChange:t,onSuccess:r,onError:o,onBatchSuccess:n,additionalData:i,allowedTypes:s}){return async({select:u,dispatch:l})=>{let d=S();for(let c of e){try{Ee(c,s),_e(c,u.getSettings().allowedMimeTypes)}catch(g){o?.(g);continue}try{Pe(c,u.getSettings().maxUploadFileSize)}catch(g){o?.(g);continue}l.addItem({file:c,batchId:d,onChange:t,onSuccess:r,onBatchSuccess:n,onError:o,additionalData:i})}}}function Ct(e,t,r=!1){return async({select:o,dispatch:n})=>{let i=o.getItem(e);if(i){if(i.abortController?.abort(),await be(e),!r){let{onError:s}=i;s?.(t??new Error("Upload cancelled")),!s&&t&&console.error("Upload cancelled",t)}n({type:a.Cancel,id:e,error:t}),n.removeItem(e),n.revokeBlobUrls(e),i.batchId&&o.isBatchUploaded(i.batchId)&&i.onBatchSuccess?.()}}}function Ot(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);o&&o.error&&(r({type:a.RetryItem,id:e}),r.processItem(e))}}var ne={};T(ne,{addItem:()=>Tt,addSideloadItem:()=>xt,finishOperation:()=>kt,generateThumbnails:()=>Xt,getTranscodeImageOperation:()=>oe,pauseItem:()=>Nt,pauseQueue:()=>Dt,prepareItem:()=>Qt,processItem:()=>Mt,removeItem:()=>zt,resizeCropItem:()=>Vt,resumeItemByPostId:()=>qt,resumeQueue:()=>Bt,revokeBlobUrls:()=>Kt,rotateItem:()=>jt,sideloadItem:()=>Ht,transcodeImageItem:()=>Yt,updateItemProgress:()=>Zt,updateSettings:()=>Jt,uploadItem:()=>$t});var v=U(Ce(),1);var Oe=class extends File{constructor(e="stub-file"){super([],e)}};var Fe=.82;function Ft(e,t,r){return t!==p.Upload||!e.parentId||!e.additionalData.post?!1:r.isUploadingToPost(e.additionalData.post)}function Tt({file:e,batchId:t,onChange:r,onSuccess:o,onBatchSuccess:n,onError:i,additionalData:s={},sourceUrl:u,sourceAttachmentId:l,abortController:d,operations:c}){return async({dispatch:g})=>{let m=S(),y=Ue(e),R;y instanceof Oe||(R=(0,v.createBlobURL)(y),g({type:a.CacheBlobUrl,id:m,blobUrl:R})),g({type:a.Add,item:{id:m,batchId:t,status:b.Processing,sourceFile:ee(y),file:y,attachment:{url:R},additionalData:{convert_format:!1,generate_sub_sizes:!1,...s},onChange:r,onSuccess:o,onBatchSuccess:n,onError:i,sourceUrl:u,sourceAttachmentId:l,abortController:d||new AbortController,operations:Array.isArray(c)?c:[p.Prepare]}}),g.processItem(m)}}function xt({file:e,onChange:t,additionalData:r,operations:o,batchId:n,parentId:i}){return({dispatch:s})=>{let u=S();s({type:a.Add,item:{id:u,batchId:n,status:b.Processing,sourceFile:ee(e),file:e,onChange:t,additionalData:{...r},parentId:i,operations:Array.isArray(o)?o:[p.Prepare],abortController:new AbortController}}),s.processItem(u)}}function Mt(e){return async({select:t,dispatch:r})=>{if(t.isPaused())return;let o=t.getItem(e);if(!o)return;let{attachment:n,onChange:i,onSuccess:s,onBatchSuccess:u,batchId:l,parentId:d}=o,c=Array.isArray(o.operations?.[0])?o.operations[0][0]:o.operations?.[0],g=Array.isArray(o.operations?.[0])?o.operations[0][1]:void 0;if(Ft(o,c,t)){r({type:a.PauseItem,id:e});return}if(c===p.Upload){let m=t.getSettings();if(t.getActiveUploadCount()>=m.maxConcurrentUploads)return}if(c===p.ResizeCrop||c===p.Rotate){let m=t.getSettings();if(t.getActiveImageProcessingCount()>=m.maxConcurrentImageProcessing)return}if(n&&i?.([n]),!c){if((d||!d&&!t.hasPendingItemsByParentId(e))&&(n&&s?.([n]),r.removeItem(e),r.revokeBlobUrls(e),l&&t.isBatchUploaded(l)&&u?.()),d&&l&&t.isBatchUploaded(l)){let m=t.getItem(d);if(!m)return;n&&m.onSuccess?.([n]),r.removeItem(d),r.revokeBlobUrls(d),m.batchId&&t.isBatchUploaded(m.batchId)&&m.onBatchSuccess?.()}return}switch(r({type:a.OperationStart,id:e,operation:c}),c){case p.Prepare:r.prepareItem(o.id);break;case p.ResizeCrop:r.resizeCropItem(o.id,g);break;case p.Rotate:r.rotateItem(o.id,g);break;case p.TranscodeImage:r.transcodeImageItem(o.id,g);break;case p.Upload:o.parentId?r.sideloadItem(e):r.uploadItem(e);break;case p.ThumbnailGeneration:r.generateThumbnails(e);break}}}function Dt(){return{type:a.PauseQueue}}function Bt(){return async({select:e,dispatch:t})=>{t({type:a.ResumeQueue});for(let r of e.getAllItems())t.processItem(r.id)}}function Nt(e){return async({dispatch:t})=>{t({type:a.PauseItem,id:e})}}function qt(e){return async({select:t,dispatch:r})=>{let o=t.getPausedUploadForPost(e);o&&(r({type:a.ResumeItem,id:o.id}),r.processItem(o.id))}}function zt(e){return async({select:t,dispatch:r})=>{t.getItem(e)&&(r({type:a.Remove,id:e}),t.getAllItems().length===0&&Re())}}function kt(e,t){return async({select:r,dispatch:o})=>{let i=r.getItem(e)?.currentOperation;if(o({type:a.OperationFinish,id:e,item:t}),o.processItem(e),i===p.Upload){let s=r.getPendingUploads();for(let u of s)o.processItem(u.id)}if(i===p.ResizeCrop||i===p.Rotate){let s=r.getPendingImageProcessing();for(let u of s)o.processItem(u.id)}}}var Lt=["jpeg","webp","avif","png","gif"];function Wt(e){return Lt.includes(e)}function Gt(e,t){switch(e){case"image/jpeg":return t.jpegInterlaced??!1;case"image/png":return t.pngInterlaced??!1;case"image/gif":return t.gifInterlaced??!1;default:return!1}}async function oe(e,t,r){if(e.type==="image/png"&&t==="image/jpeg"){let n=(0,v.createBlobURL)(e);try{if(await ve(n))return null}catch{return null}finally{(0,v.revokeBlobURL)(n)}}let o=t.split("/")[1];return Wt(o)?[p.TranscodeImage,{outputFormat:o,outputQuality:Fe,interlaced:Gt(t,r)}]:null}function Qt(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);if(!o)return;let{file:n}=o,i=[],s=t.getSettings(),u=n.type.startsWith("image/"),l=me.includes(n.type);if(u&&l){let{imageOutputFormats:c}=s,g=c?.[n.type];if(g&&g!==n.type){let m=await oe(n,g,s);m&&i.push(m)}i.push(p.Upload,p.ThumbnailGeneration)}else i.push(p.Upload);r({type:a.AddOperations,id:e,operations:i});let d=!l||!u?{additionalData:{...o.additionalData,generate_sub_sizes:!0}}:{};r.finishOperation(e,d)}}function $t(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);o&&t.getSettings().mediaUpload({filesList:[o.file],additionalData:o.additionalData,signal:o.abortController?.signal,onFileChange:([n])=>{(0,v.isBlobURL)(n.url)||r.finishOperation(e,{attachment:n})},onSuccess:([n])=>{r.finishOperation(e,{attachment:n})},onError:n=>{r.cancelItem(e,n)}})}}function Ht(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);if(!o)return;let{post:n,...i}=o.additionalData,s=t.getSettings().mediaSideload;if(!s){r.finishOperation(e,{});return}s({file:o.file,attachmentId:n,additionalData:i,signal:o.abortController?.signal,onFileChange:([u])=>{r.finishOperation(e,{attachment:u}),r.resumeItemByPostId(n)},onError:u=>{r.cancelItem(e,u),r.resumeItemByPostId(n)}})}}function Vt(e,t){return async({select:r,dispatch:o})=>{let n=r.getItem(e);if(!n)return;if(!t?.resize){o.finishOperation(e,{file:n.file});return}let i=!!n.parentId,s=!!t.isThresholdResize;try{let u=await we(n.id,n.file,t.resize,!1,i,n.abortController?.signal,s),l=(0,v.createBlobURL)(u);o({type:a.CacheBlobUrl,id:e,blobUrl:l}),o.finishOperation(e,{file:u,attachment:{url:l}})}catch(u){o.cancelItem(e,new h({code:"IMAGE_TRANSCODING_ERROR",message:"File could not be uploaded",file:n.file,cause:u instanceof Error?u:void 0}))}}}function jt(e,t){return async({select:r,dispatch:o})=>{let n=r.getItem(e);if(n){if(!t?.orientation||t.orientation===1){o.finishOperation(e,{file:n.file});return}try{let i=await re(n.id,n.file,t.orientation,n.abortController?.signal),s=(0,v.createBlobURL)(i);o({type:a.CacheBlobUrl,id:e,blobUrl:s}),o.finishOperation(e,{file:i,attachment:{url:s}})}catch(i){o.cancelItem(e,new h({code:"IMAGE_ROTATION_ERROR",message:"Image could not be rotated",file:n.file,cause:i instanceof Error?i:void 0}))}}}}function Yt(e,t){return async({select:r,dispatch:o})=>{let n=r.getItem(e);if(!n)return;if(!t?.outputFormat){o.finishOperation(e,{file:n.file});return}let i=`image/${t.outputFormat}`,s=t.outputQuality??Fe,u=t.interlaced??!1;try{let l=await he(n.id,n.file,i,s,u),d=(0,v.createBlobURL)(l);o({type:a.CacheBlobUrl,id:e,blobUrl:d}),o.finishOperation(e,{file:l,attachment:{url:d}})}catch(l){o.cancelItem(e,new h({code:"MEDIA_TRANSCODING_ERROR",message:"Image could not be transcoded to the target format",file:n.file,cause:l instanceof Error?l:void 0}))}}}function Xt(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);if(!o)return;if(!o.attachment){r.finishOperation(e,{});return}let n=o.attachment;if(n.exif_orientation&&n.exif_orientation!==1&&!o.file.name.includes("-scaled")&&n.id)try{let s=await re(o.id,o.sourceFile,n.exif_orientation,o.abortController?.signal);r.addSideloadItem({file:s,batchId:S(),parentId:o.id,additionalData:{post:n.id,image_size:"original",convert_format:!1},operations:[p.Upload]})}catch{console.warn("Failed to rotate image, continuing with thumbnails")}if(!o.parentId&&n.missing_image_sizes&&n.missing_image_sizes.length>0){let s=n.filename?L(o.sourceFile,n.filename):o.sourceFile,u=S(),l=t.getSettings(),d=l.allImageSizes||{},{imageOutputFormats:c}=l,g=o.sourceFile.type,m=c?.[g],y=null;m&&m!==g&&(y=await oe(o.sourceFile,m,l));for(let P of n.missing_image_sizes){let w=d[P];if(!w){console.warn(`Image size "${P}" not found in configuration`);continue}let A=[[p.ResizeCrop,{resize:w}]];y&&A.push(y),A.push(p.Upload),r.addSideloadItem({file:s,onChange:([ue])=>{(0,v.isBlobURL)(ue.url)||o.onChange?.([ue])},batchId:u,parentId:o.id,additionalData:{post:n.id,image_size:P,convert_format:!1},operations:A})}let{bigImageSizeThreshold:R}=l;if(R&&n.id){let P=n.filename?L(o.sourceFile,n.filename):o.sourceFile,w=[[p.ResizeCrop,{resize:{width:R,height:R},isThresholdResize:!0}]];y&&w.push(y),w.push(p.Upload),r.addSideloadItem({file:P,onChange:([A])=>{(0,v.isBlobURL)(A.url)||o.onChange?.([A])},batchId:u,parentId:o.id,additionalData:{post:n.id,image_size:"scaled",convert_format:!1},operations:w})}}r.finishOperation(e,{})}}function Kt(e){return async({select:t,dispatch:r})=>{let o=t.getBlobUrls(e);for(let n of o)(0,v.revokeBlobURL)(n);r({type:a.RevokeBlobUrls,id:e})}}function Zt(e,t){return async({dispatch:r})=>{r({type:a.UpdateProgress,id:e,progress:t})}}function Jt(e){return{type:a.UpdateSettings,settings:e}}var Me=U(xe(),1),{lock:ro,unlock:D}=(0,Me.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.","@wordpress/upload-media");var De={reducer:Y,selectors:z,actions:H},_=(0,O.createReduxStore)(q,{reducer:Y,selectors:z,actions:H});(0,O.select)(_)||(0,O.register)(_);D(_).registerPrivateActions(ne);D(_).registerPrivateSelectors(X);var Ge=U(ie(),1),Qe=U(N(),1);var ke=U(ie(),1),F=U(N(),1),Le=U(qe(),1);var V=U(ae(),1);function er(e,t,r){if(!r)return t;let o=e.get(t);return o||(o=(0,F.createRegistry)({},t),o.registerStore(q,De),e.set(t,o)),o}var tr=(0,Le.createHigherOrderComponent)(e=>({useSubRegistry:t=!0,...r})=>{let o=(0,F.useRegistry)(),[n]=(0,ke.useState)(()=>new WeakMap),i=er(n,o,t);return i===o?(0,V.jsx)(e,{registry:o,...r}):(0,V.jsx)(F.RegistryProvider,{value:i,children:(0,V.jsx)(e,{registry:i,...r})})},"withRegistryProvider"),We=tr;var j=U(ae(),1),rr=We(e=>{let{children:t,settings:r}=e,{updateSettings:o}=D((0,Qe.useDispatch)(_));return(0,Ge.useEffect)(()=>{o(r)},[r,o]),(0,j.jsx)(j.Fragment,{children:t})}),$e=rr;var f=null;function se(){if(f!==null)return f;if(typeof WebAssembly>"u")return f={supported:!1,reason:"WebAssembly is not supported in this browser."},f;if(typeof SharedArrayBuffer>"u")return f={supported:!1,reason:"SharedArrayBuffer is not available. This may be due to missing cross-origin isolation headers."},f;if(typeof Worker>"u")return f={supported:!1,reason:"Web Workers are not supported in this browser."},f;if(typeof window<"u"&&window.HTMLIFrameElement&&!("credentialless"in window.HTMLIFrameElement.prototype))return f={supported:!1,reason:"Browser does not support credentialless iframes. Cross-origin isolation would break third-party embeds"},f;if(typeof navigator<"u"&&"deviceMemory"in navigator&&navigator.deviceMemory<=2)return f={supported:!1,reason:"Device has insufficient memory for client-side media processing."},f;if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency<4)return f={supported:!1,reason:"Device has insufficient CPU cores for client-side media processing."},f;if(typeof navigator<"u"){let e=navigator.connection;if(e){if(e.saveData)return f={supported:!1,reason:"Data saver mode is enabled."},f;if(e.effectiveType==="slow-2g"||e.effectiveType==="2g"||e.effectiveType==="3g")return f={supported:!1,reason:"Network connection is too slow for client-side media processing."},f}}if(typeof window<"u")try{let e=new Blob([""],{type:"application/javascript"}),t=URL.createObjectURL(e);try{new Worker(t).terminate()}finally{URL.revokeObjectURL(t)}}catch{return f={supported:!1,reason:"The site's Content Security Policy (CSP) does not allow blob: workers. The worker-src directive must include blob: to enable client-side media processing."},f}return f={supported:!0},f}function He(){return se().supported}function Ve(){f=null}return et(or);})();