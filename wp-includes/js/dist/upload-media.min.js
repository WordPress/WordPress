"use strict";var wp;(wp||={}).uploadMedia=(()=>{var je=Object.create;var M=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var Ye=Object.getOwnPropertyNames;var Xe=Object.getPrototypeOf,Ke=Object.prototype.hasOwnProperty;var Ze=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var E=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),C=(e,t)=>{for(var r in t)M(e,r,{get:t[r],enumerable:!0})},ue=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ye(t))!Ke.call(e,n)&&n!==r&&M(e,n,{get:()=>t[n],enumerable:!(o=He(t,n))||o.enumerable});return e};var y=(e,t,r)=>(r=e!=null?je(Xe(e)):{},ue(t||!e||!e.__esModule?M(r,"default",{value:e,enumerable:!0}):r,e)),Je=e=>ue(M({},"__esModule",{value:!0}),e);var D=E((nr,le)=>{le.exports=window.wp.data});var ge=E((Rr,fe)=>{fe.exports=window.wp.url});var T=E((wr,Ie)=>{Ie.exports=window.wp.i18n});var Ae=E((Qr,Pe)=>{Pe.exports=window.wp.blob});var Fe=E((eo,Te)=>{Te.exports=window.wp.privateApis});var ne=E((so,De)=>{De.exports=window.wp.element});var qe=E((uo,Be)=>{Be.exports=window.wp.compose});var ie=E((lo,Ne)=>{Ne.exports=window.ReactJSXRuntime});var rr={};C(rr,{MediaUploadProvider:()=>Qe,UploadError:()=>U,clearFeatureDetectionCache:()=>Ve,detectClientSideMediaSupport:()=>ae,isClientSideMediaSupported:()=>$e,store:()=>_});var A=y(D(),1);var a=(e=>(e.Unknown="REDUX_UNKNOWN",e.Add="ADD_ITEM",e.Prepare="PREPARE_ITEM",e.Cancel="CANCEL_ITEM",e.Remove="REMOVE_ITEM",e.RetryItem="RETRY_ITEM",e.PauseItem="PAUSE_ITEM",e.ResumeItem="RESUME_ITEM",e.PauseQueue="PAUSE_QUEUE",e.ResumeQueue="RESUME_QUEUE",e.OperationStart="OPERATION_START",e.OperationFinish="OPERATION_FINISH",e.AddOperations="ADD_OPERATIONS",e.CacheBlobUrl="CACHE_BLOB_URL",e.RevokeBlobUrls="REVOKE_BLOB_URLS",e.UpdateProgress="UPDATE_PROGRESS",e.UpdateSettings="UPDATE_SETTINGS",e))(a||{}),v=(e=>(e.Queued="QUEUED",e.Processing="PROCESSING",e.Paused="PAUSED",e.Uploaded="UPLOADED",e.Error="ERROR",e))(v||{}),l=(e=>(e.Prepare="PREPARE",e.Upload="UPLOAD",e.ResizeCrop="RESIZE_CROP",e.Rotate="ROTATE",e.TranscodeImage="TRANSCODE_IMAGE",e.ThumbnailGeneration="THUMBNAIL_GENERATION",e))(l||{});var B="core/upload-media",pe=5,ce=2,me=["image/jpeg","image/png","image/gif","image/webp","image/avif"];var et=()=>{},tt={queue:[],queueStatus:"active",blobUrls:{},settings:{mediaUpload:et,maxConcurrentUploads:pe,maxConcurrentImageProcessing:ce}};function rt(e=tt,t={type:a.Unknown}){switch(t.type){case a.PauseQueue:return{...e,queueStatus:"paused"};case a.ResumeQueue:return{...e,queueStatus:"active"};case a.PauseItem:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,status:v.Paused}:r)};case a.ResumeItem:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,status:v.Processing}:r)};case a.Add:return{...e,queue:[...e.queue,t.item]};case a.Cancel:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,error:t.error}:r)};case a.RetryItem:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,status:v.Processing,error:void 0,retryCount:(r.retryCount??0)+1}:r)};case a.Remove:return{...e,queue:e.queue.filter(r=>r.id!==t.id)};case a.OperationStart:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,currentOperation:t.operation}:r)};case a.AddOperations:return{...e,queue:e.queue.map(r=>r.id!==t.id?r:{...r,operations:[...r.operations||[],...t.operations]})};case a.OperationFinish:return{...e,queue:e.queue.map(r=>{if(r.id!==t.id)return r;let o=r.operations?r.operations.slice(1):[],n=r.attachment||t.item.attachment?{...r.attachment,...t.item.attachment}:void 0;return{...r,currentOperation:void 0,operations:o,...t.item,attachment:n,additionalData:{...r.additionalData,...t.item.additionalData}}})};case a.CacheBlobUrl:{let r=e.blobUrls[t.id]||[];return{...e,blobUrls:{...e.blobUrls,[t.id]:[...r,t.blobUrl]}}}case a.RevokeBlobUrls:{let r={...e.blobUrls};return delete r[t.id],{...e,blobUrls:r}}case a.UpdateProgress:return{...e,queue:e.queue.map(r=>r.id===t.id?{...r,progress:t.progress}:r)};case a.UpdateSettings:return{...e,settings:{...e.settings,...t.settings}}}return e}var j=rt;var q={};C(q,{getItems:()=>ot,getSettings:()=>st,isUploading:()=>nt,isUploadingById:()=>at,isUploadingByUrl:()=>it});function ot(e){return e.queue}function nt(e){return e.queue.length>=1}function it(e,t){return e.queue.some(r=>r.attachment?.url===t||r.sourceUrl===t)}function at(e,t){return e.queue.some(r=>r.attachment?.id===t||r.sourceAttachmentId===t)}function st(e){return e.settings}var H={};C(H,{getActiveImageProcessingCount:()=>yt,getActiveUploadCount:()=>gt,getAllItems:()=>ut,getBlobUrls:()=>ft,getFailedItems:()=>ht,getItem:()=>lt,getItemProgress:()=>vt,getPausedUploadForPost:()=>mt,getPendingImageProcessing:()=>Ut,getPendingUploads:()=>It,hasPendingItemsByParentId:()=>bt,isBatchUploaded:()=>pt,isPaused:()=>dt,isUploadingToPost:()=>ct});function ut(e){return e.queue}function lt(e,t){return e.queue.find(r=>r.id===t)}function pt(e,t){return e.queue.filter(o=>t===o.batchId).length===0}function ct(e,t){return e.queue.some(r=>r.currentOperation===l.Upload&&r.additionalData.post===t)}function mt(e,t){return e.queue.find(r=>r.status===v.Paused&&r.additionalData.post===t)}function dt(e){return e.queueStatus==="paused"}function ft(e,t){return e.blobUrls[t]||[]}function gt(e){return e.queue.filter(t=>t.currentOperation===l.Upload).length}function It(e){return e.queue.filter(t=>(Array.isArray(t.operations?.[0])?t.operations[0][0]:t.operations?.[0])===l.Upload&&t.currentOperation!==l.Upload)}function yt(e){return e.queue.filter(t=>t.currentOperation===l.ResizeCrop||t.currentOperation===l.Rotate).length}function Ut(e){return e.queue.filter(t=>{let r=Array.isArray(t.operations?.[0])?t.operations[0][0]:t.operations?.[0];return(r===l.ResizeCrop||r===l.Rotate)&&t.currentOperation!==l.ResizeCrop&&t.currentOperation!==l.Rotate})}function ht(e){return e.queue.filter(t=>t.error!==void 0)}function bt(e,t){return e.queue.some(r=>r.parentId===t)}function vt(e,t){return e.queue.find(o=>o.id===t)?.progress}var G={};C(G,{addItems:()=>Pt,cancelItem:()=>At,retryItem:()=>Ot});var N,Rt=new Uint8Array(16);function Y(){if(!N&&(N=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!N))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return N(Rt)}var I=[];for(let e=0;e<256;++e)I.push((e+256).toString(16).slice(1));function de(e,t=0){return I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]}var wt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),X={randomUUID:wt};function Et(e,t,r){if(X.randomUUID&&!t&&!e)return X.randomUUID();e=e||{};let o=e.random||(e.rng||Y)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){r=r||0;for(let n=0;n<16;++n)t[r+n]=o[n];return t}return de(o)}var S=Et;var K=class extends File{width=0;height=0;originalWidth=0;originalHeight=0;get wasResized(){return(this.originalWidth||0)>this.width||(this.originalHeight||0)>this.height}constructor(e,t,r,o,n){super([e],e.name,{type:e.type,lastModified:e.lastModified}),this.width=t,this.height=r,this.originalWidth=o,this.originalHeight=n}};var St=y(ge(),1),_t=y(T(),1);function ye(e){if(e instanceof File)return e;let t=e.type.split("/")[1],r=e.type==="application/pdf"?"document":e.type.split("/")[0];return new File([e],`${r}.${t}`,{type:e.type})}function Z(e,t){return new File([e],t,{type:e.type,lastModified:e.lastModified})}function J(e){return Z(e,e.name)}function z(e){return e.includes(".")?e.split(".").slice(0,-1).join("."):e}var ee,F;function k(){return ee||(ee=import("@wordpress/vips/worker").then(e=>(F=e,e))),ee}async function Ue(e,t,r,o,n){let{vipsConvertImageFormat:i}=await k(),s=await i(e,await t.arrayBuffer(),t.type,r,o,n),u=r.split("/")[1],p=`${z(t.name)}.${u}`;return new File([new Blob([s])],p,{type:r})}async function he(e){let{vipsHasTransparency:t}=await k(),r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch image: ${r.status}`);return t(await r.arrayBuffer())}async function be(e,t,r,o,n,i,s){if(i?.aborted)throw new Error("Operation aborted");let{vipsResizeImage:u}=await k(),{buffer:p,width:d,height:c,originalWidth:f,originalHeight:m}=await u(e,await t.arrayBuffer(),t.type,r,o),g=t.name;if(f>d||m>c){let w=z(t.name);s?g=t.name.replace(w,`${w}-scaled`):n&&(g=t.name.replace(w,`${w}-${d}x${c}`))}return new K(new File([new Blob([p],{type:t.type})],g,{type:t.type}),d,c,f,m)}async function te(e,t,r,o){if(o?.aborted)throw new Error("Operation aborted");if(r===1)return t;let{vipsRotateImage:n}=await k(),{buffer:i,width:s,height:u}=await n(e,await t.arrayBuffer(),t.type,r),p=z(t.name),d=t.name.replace(p,`${p}-rotated`);return new K(new File([new Blob([i],{type:t.type})],d,{type:t.type}),s,u)}async function ve(e){return F?F.vipsCancelOperations(e):!1}function Re(){F&&F.terminateVipsWorker()}var L=y(T(),1);var U=class extends Error{code;file;constructor({code:e,message:t,file:r,cause:o}){super(t,{cause:o}),Object.setPrototypeOf(this,new.target.prototype),this.code=e,this.file=r}};function we(e,t){if(!t)return;let r=t.some(o=>o.includes("/")?o===e.type:e.type.startsWith(`${o}/`));if(e.type&&!r)throw new U({code:"MIME_TYPE_NOT_SUPPORTED",message:(0,L.sprintf)((0,L.__)("%s: Sorry, this file type is not supported here."),e.name),file:e})}var W=y(T(),1);function Ee(e){return e?Object.entries(e).flatMap(([t,r])=>{let[o]=r.split("/"),n=t.split("|");return[r,...n.map(i=>`${o}/${i}`)]}):null}function Se(e,t){let r=Ee(t);if(!r)return;let o=r.includes(e.type);if(e.type&&!o)throw new U({code:"MIME_TYPE_NOT_ALLOWED_FOR_USER",message:(0,W.sprintf)((0,W.__)("%s: Sorry, you are not allowed to upload this file type."),e.name),file:e})}var P=y(T(),1);function _e(e,t){if(e.size<=0)throw new U({code:"EMPTY_FILE",message:(0,P.sprintf)((0,P.__)("%s: This file is empty."),e.name),file:e});if(t&&e.size>t)throw new U({code:"SIZE_ABOVE_LIMIT",message:(0,P.sprintf)((0,P.__)("%s: This file exceeds the maximum upload size for this site."),e.name),file:e})}function Pt({files:e,onChange:t,onSuccess:r,onError:o,onBatchSuccess:n,additionalData:i,allowedTypes:s}){return async({select:u,dispatch:p})=>{let d=S();for(let c of e){try{we(c,s),Se(c,u.getSettings().allowedMimeTypes)}catch(f){o?.(f);continue}try{_e(c,u.getSettings().maxUploadFileSize)}catch(f){o?.(f);continue}p.addItem({file:c,batchId:d,onChange:t,onSuccess:r,onBatchSuccess:n,onError:o,additionalData:i})}}}function At(e,t,r=!1){return async({select:o,dispatch:n})=>{let i=o.getItem(e);if(i){if(i.abortController?.abort(),await ve(e),!r){let{onError:s}=i;s?.(t??new Error("Upload cancelled")),!s&&t&&console.error("Upload cancelled",t)}n({type:a.Cancel,id:e,error:t}),n.removeItem(e),n.revokeBlobUrls(e),i.batchId&&o.isBatchUploaded(i.batchId)&&i.onBatchSuccess?.()}}}function Ot(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);o&&o.error&&(r({type:a.RetryItem,id:e}),r.processItem(e))}}var oe={};C(oe,{addItem:()=>Tt,addSideloadItem:()=>Ft,finishOperation:()=>zt,generateThumbnails:()=>Yt,getTranscodeImageOperation:()=>re,pauseItem:()=>Bt,pauseQueue:()=>Mt,prepareItem:()=>Gt,processItem:()=>xt,removeItem:()=>Nt,resizeCropItem:()=>Vt,resumeItemByPostId:()=>qt,resumeQueue:()=>Dt,revokeBlobUrls:()=>Xt,rotateItem:()=>jt,sideloadItem:()=>$t,transcodeImageItem:()=>Ht,updateItemProgress:()=>Kt,updateSettings:()=>Zt,uploadItem:()=>Qt});var h=y(Ae(),1);var Oe=class extends File{constructor(e="stub-file"){super([],e)}};var Ce=.82;function Ct(e,t,r){return t!==l.Upload||!e.parentId||!e.additionalData.post?!1:r.isUploadingToPost(e.additionalData.post)}function Tt({file:e,batchId:t,onChange:r,onSuccess:o,onBatchSuccess:n,onError:i,additionalData:s={},sourceUrl:u,sourceAttachmentId:p,abortController:d,operations:c}){return async({dispatch:f})=>{let m=S(),g=ye(e),R;g instanceof Oe||(R=(0,h.createBlobURL)(g),f({type:a.CacheBlobUrl,id:m,blobUrl:R})),f({type:a.Add,item:{id:m,batchId:t,status:v.Processing,sourceFile:J(g),file:g,attachment:{url:R},additionalData:{convert_format:!1,generate_sub_sizes:!1,...s},onChange:r,onSuccess:o,onBatchSuccess:n,onError:i,sourceUrl:u,sourceAttachmentId:p,abortController:d||new AbortController,operations:Array.isArray(c)?c:[l.Prepare]}}),f.processItem(m)}}function Ft({file:e,onChange:t,additionalData:r,operations:o,batchId:n,parentId:i}){return({dispatch:s})=>{let u=S();s({type:a.Add,item:{id:u,batchId:n,status:v.Processing,sourceFile:J(e),file:e,onChange:t,additionalData:{...r},parentId:i,operations:Array.isArray(o)?o:[l.Prepare],abortController:new AbortController}}),s.processItem(u)}}function xt(e){return async({select:t,dispatch:r})=>{if(t.isPaused())return;let o=t.getItem(e);if(!o)return;let{attachment:n,onChange:i,onSuccess:s,onBatchSuccess:u,batchId:p,parentId:d}=o,c=Array.isArray(o.operations?.[0])?o.operations[0][0]:o.operations?.[0],f=Array.isArray(o.operations?.[0])?o.operations[0][1]:void 0;if(Ct(o,c,t)){r({type:a.PauseItem,id:e});return}if(c===l.Upload){let m=t.getSettings();if(t.getActiveUploadCount()>=m.maxConcurrentUploads)return}if(c===l.ResizeCrop||c===l.Rotate){let m=t.getSettings();if(t.getActiveImageProcessingCount()>=m.maxConcurrentImageProcessing)return}if(n&&i?.([n]),!c){if((d||!d&&!t.hasPendingItemsByParentId(e))&&(n&&s?.([n]),r.removeItem(e),r.revokeBlobUrls(e),p&&t.isBatchUploaded(p)&&u?.()),d&&p&&t.isBatchUploaded(p)){let m=t.getItem(d);if(!m)return;n&&m.onSuccess?.([n]),r.removeItem(d),r.revokeBlobUrls(d),m.batchId&&t.isBatchUploaded(m.batchId)&&m.onBatchSuccess?.()}return}switch(r({type:a.OperationStart,id:e,operation:c}),c){case l.Prepare:r.prepareItem(o.id);break;case l.ResizeCrop:r.resizeCropItem(o.id,f);break;case l.Rotate:r.rotateItem(o.id,f);break;case l.TranscodeImage:r.transcodeImageItem(o.id,f);break;case l.Upload:o.parentId?r.sideloadItem(e):r.uploadItem(e);break;case l.ThumbnailGeneration:r.generateThumbnails(e);break}}}function Mt(){return{type:a.PauseQueue}}function Dt(){return async({select:e,dispatch:t})=>{t({type:a.ResumeQueue});for(let r of e.getAllItems())t.processItem(r.id)}}function Bt(e){return async({dispatch:t})=>{t({type:a.PauseItem,id:e})}}function qt(e){return async({select:t,dispatch:r})=>{let o=t.getPausedUploadForPost(e);o&&(r({type:a.ResumeItem,id:o.id}),r.processItem(o.id))}}function Nt(e){return async({select:t,dispatch:r})=>{t.getItem(e)&&(r({type:a.Remove,id:e}),t.getAllItems().length===0&&Re())}}function zt(e,t){return async({select:r,dispatch:o})=>{let i=r.getItem(e)?.currentOperation;if(o({type:a.OperationFinish,id:e,item:t}),o.processItem(e),i===l.Upload){let s=r.getPendingUploads();for(let u of s)o.processItem(u.id)}if(i===l.ResizeCrop||i===l.Rotate){let s=r.getPendingImageProcessing();for(let u of s)o.processItem(u.id)}}}var kt=["jpeg","webp","avif","png","gif"];function Lt(e){return kt.includes(e)}function Wt(e,t){switch(e){case"image/jpeg":return t.jpegInterlaced??!1;case"image/png":return t.pngInterlaced??!1;case"image/gif":return t.gifInterlaced??!1;default:return!1}}async function re(e,t,r){if(e.type==="image/png"&&t==="image/jpeg"){let n=(0,h.createBlobURL)(e);try{if(await he(n))return null}catch{return null}finally{(0,h.revokeBlobURL)(n)}}let o=t.split("/")[1];return Lt(o)?[l.TranscodeImage,{outputFormat:o,outputQuality:Ce,interlaced:Wt(t,r)}]:null}function Gt(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);if(!o)return;let{file:n}=o,i=[],s=t.getSettings(),u=n.type.startsWith("image/"),p=me.includes(n.type);if(u&&p){let{bigImageSizeThreshold:c,imageOutputFormats:f}=s;c&&i.push([l.ResizeCrop,{resize:{width:c,height:c},isThresholdResize:!0}]);let m=f?.[n.type];if(m&&m!==n.type){let g=await re(n,m,s);g&&i.push(g)}i.push(l.Upload,l.ThumbnailGeneration)}else i.push(l.Upload);r({type:a.AddOperations,id:e,operations:i});let d=!p||!u?{additionalData:{...o.additionalData,generate_sub_sizes:!0}}:{};r.finishOperation(e,d)}}function Qt(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);o&&t.getSettings().mediaUpload({filesList:[o.file],additionalData:o.additionalData,signal:o.abortController?.signal,onFileChange:([n])=>{(0,h.isBlobURL)(n.url)||r.finishOperation(e,{attachment:n})},onSuccess:([n])=>{r.finishOperation(e,{attachment:n})},onError:n=>{r.cancelItem(e,n)}})}}function $t(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);if(!o)return;let{post:n,...i}=o.additionalData,s=t.getSettings().mediaSideload;if(!s){r.finishOperation(e,{});return}s({file:o.file,attachmentId:n,additionalData:i,signal:o.abortController?.signal,onFileChange:([u])=>{r.finishOperation(e,{attachment:u}),r.resumeItemByPostId(n)},onError:u=>{r.cancelItem(e,u),r.resumeItemByPostId(n)}})}}function Vt(e,t){return async({select:r,dispatch:o})=>{let n=r.getItem(e);if(!n)return;if(!t?.resize){o.finishOperation(e,{file:n.file});return}let i=!!n.parentId,s=!!t.isThresholdResize;try{let u=await be(n.id,n.file,t.resize,!1,i,n.abortController?.signal,s),p=(0,h.createBlobURL)(u);o({type:a.CacheBlobUrl,id:e,blobUrl:p}),o.finishOperation(e,{file:u,attachment:{url:p}})}catch(u){o.cancelItem(e,new U({code:"IMAGE_TRANSCODING_ERROR",message:"File could not be uploaded",file:n.file,cause:u instanceof Error?u:void 0}))}}}function jt(e,t){return async({select:r,dispatch:o})=>{let n=r.getItem(e);if(n){if(!t?.orientation||t.orientation===1){o.finishOperation(e,{file:n.file});return}try{let i=await te(n.id,n.file,t.orientation,n.abortController?.signal),s=(0,h.createBlobURL)(i);o({type:a.CacheBlobUrl,id:e,blobUrl:s}),o.finishOperation(e,{file:i,attachment:{url:s}})}catch(i){o.cancelItem(e,new U({code:"IMAGE_ROTATION_ERROR",message:"Image could not be rotated",file:n.file,cause:i instanceof Error?i:void 0}))}}}}function Ht(e,t){return async({select:r,dispatch:o})=>{let n=r.getItem(e);if(!n)return;if(!t?.outputFormat){o.finishOperation(e,{file:n.file});return}let i=`image/${t.outputFormat}`,s=t.outputQuality??Ce,u=t.interlaced??!1;try{let p=await Ue(n.id,n.file,i,s,u),d=(0,h.createBlobURL)(p);o({type:a.CacheBlobUrl,id:e,blobUrl:d}),o.finishOperation(e,{file:p,attachment:{url:d}})}catch(p){o.cancelItem(e,new U({code:"MEDIA_TRANSCODING_ERROR",message:"Image could not be transcoded to the target format",file:n.file,cause:p instanceof Error?p:void 0}))}}}function Yt(e){return async({select:t,dispatch:r})=>{let o=t.getItem(e);if(!o)return;if(!o.attachment){r.finishOperation(e,{});return}let n=o.attachment;if(n.exif_orientation&&n.exif_orientation!==1&&!o.file.name.includes("-scaled")&&n.id)try{let s=await te(o.id,o.sourceFile,n.exif_orientation,o.abortController?.signal);r.addSideloadItem({file:s,batchId:S(),parentId:o.id,additionalData:{post:n.id,image_size:"original",convert_format:!1},operations:[l.Upload]})}catch{console.warn("Failed to rotate image, continuing with thumbnails")}if(!o.parentId&&n.missing_image_sizes&&n.missing_image_sizes.length>0){let s=n.media_filename?Z(o.sourceFile,n.media_filename):o.sourceFile,u=S(),p=t.getSettings(),d=p.allImageSizes||{},{imageOutputFormats:c}=p,f=o.sourceFile.type,m=c?.[f],g=null;m&&m!==f&&(g=await re(o.sourceFile,m,p));for(let R of n.missing_image_sizes){let V=d[R];if(!V){console.warn(`Image size "${R}" not found in configuration`);continue}let w=[[l.ResizeCrop,{resize:V}]];g&&w.push(g),w.push(l.Upload),r.addSideloadItem({file:s,onChange:([se])=>{(0,h.isBlobURL)(se.url)||o.onChange?.([se])},batchId:u,parentId:o.id,additionalData:{post:n.id,image_size:R,convert_format:!1},operations:w})}}r.finishOperation(e,{})}}function Xt(e){return async({select:t,dispatch:r})=>{let o=t.getBlobUrls(e);for(let n of o)(0,h.revokeBlobURL)(n);r({type:a.RevokeBlobUrls,id:e})}}function Kt(e,t){return async({dispatch:r})=>{r({type:a.UpdateProgress,id:e,progress:t})}}function Zt(e){return{type:a.UpdateSettings,settings:e}}var xe=y(Fe(),1),{lock:to,unlock:x}=(0,xe.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.","@wordpress/upload-media");var Me={reducer:j,selectors:q,actions:G},_=(0,A.createReduxStore)(B,{reducer:j,selectors:q,actions:G});(0,A.select)(_)||(0,A.register)(_);x(_).registerPrivateActions(oe);x(_).registerPrivateSelectors(H);var We=y(ne(),1),Ge=y(D(),1);var ze=y(ne(),1),O=y(D(),1),ke=y(qe(),1);var Q=y(ie(),1);function Jt(e,t,r){if(!r)return t;let o=e.get(t);return o||(o=(0,O.createRegistry)({},t),o.registerStore(B,Me),e.set(t,o)),o}var er=(0,ke.createHigherOrderComponent)(e=>({useSubRegistry:t=!0,...r})=>{let o=(0,O.useRegistry)(),[n]=(0,ze.useState)(()=>new WeakMap),i=Jt(n,o,t);return i===o?(0,Q.jsx)(e,{registry:o,...r}):(0,Q.jsx)(O.RegistryProvider,{value:i,children:(0,Q.jsx)(e,{registry:i,...r})})},"withRegistryProvider"),Le=er;var $=y(ie(),1),tr=Le(e=>{let{children:t,settings:r}=e,{updateSettings:o}=x((0,Ge.useDispatch)(_));return(0,We.useEffect)(()=>{o(r)},[r,o]),(0,$.jsx)($.Fragment,{children:t})}),Qe=tr;var b=null;function ae(){if(b!==null)return b;if(typeof WebAssembly>"u")return b={supported:!1,reason:"WebAssembly is not supported in this browser"},b;if(typeof SharedArrayBuffer>"u")return b={supported:!1,reason:"SharedArrayBuffer is not available. This may be due to missing cross-origin isolation headers."},b;if(typeof window<"u"&&typeof Worker<"u")try{let e=new Blob([""],{type:"application/javascript"}),t=URL.createObjectURL(e);try{new Worker(t).terminate()}finally{URL.revokeObjectURL(t)}}catch{return b={supported:!1,reason:"The site's Content Security Policy (CSP) does not allow blob: workers. The worker-src directive must include blob: to enable client-side media processing."},b}return b={supported:!0},b}function $e(){return ae().supported}function Ve(){b=null}return Je(rr);})();