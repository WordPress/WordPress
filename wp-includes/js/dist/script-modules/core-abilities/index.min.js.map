{
  "version": 3,
  "sources": ["package-external:@wordpress/api-fetch", "package-external:@wordpress/url", "../../../packages/core-abilities/src/index.ts"],
  "sourcesContent": ["module.exports = window.wp.apiFetch;", "module.exports = window.wp.url;", "/**\n * WordPress dependencies\n */\nimport { registerAbility, registerAbilityCategory } from '@wordpress/abilities';\nimport type {\n\tAbility,\n\tAbilityCategory,\n\tAbilityInput,\n\tAbilityOutput,\n} from '@wordpress/abilities';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n/**\n * API endpoint constants.\n */\nconst API_BASE = '/wp-abilities/v1';\nconst ABILITIES_ENDPOINT = `${ API_BASE }/abilities`;\nconst CATEGORIES_ENDPOINT = `${ API_BASE }/categories`;\n\n/**\n * Creates a serverCallback function for a WordPress REST API ability.\n *\n * @param ability The ability to create a callback for.\n * @return The serverCallback function.\n */\nfunction createServerCallback(\n\tability: Ability\n): ( input: AbilityInput ) => Promise< AbilityOutput > {\n\treturn async ( input: AbilityInput ) => {\n\t\t// Determine HTTP method based on ability annotations\n\t\tlet method = 'POST';\n\t\tif ( !! ability.meta?.annotations?.readonly ) {\n\t\t\tmethod = 'GET';\n\t\t} else if (\n\t\t\t!! ability.meta?.annotations?.destructive &&\n\t\t\t!! ability.meta?.annotations?.idempotent\n\t\t) {\n\t\t\tmethod = 'DELETE';\n\t\t}\n\n\t\tlet path = `${ ABILITIES_ENDPOINT }/${ ability.name }/run`;\n\t\tconst options: {\n\t\t\tmethod: string;\n\t\t\tdata?: { input: AbilityInput };\n\t\t} = {\n\t\t\tmethod,\n\t\t};\n\n\t\tif (\n\t\t\t[ 'GET', 'DELETE' ].includes( method ) &&\n\t\t\tinput !== null &&\n\t\t\tinput !== undefined\n\t\t) {\n\t\t\t// For GET and DELETE requests, pass the input as query parameters.\n\t\t\tpath = addQueryArgs( path, { input } );\n\t\t} else if (\n\t\t\tmethod === 'POST' &&\n\t\t\tinput !== null &&\n\t\t\tinput !== undefined\n\t\t) {\n\t\t\toptions.data = { input };\n\t\t}\n\n\t\t// Input and output validation happens on the server side for these abilities.\n\t\treturn apiFetch< AbilityOutput >( {\n\t\t\tpath,\n\t\t\t...options,\n\t\t} );\n\t};\n}\n\n/**\n * Fetches and registers all ability categories from WordPress.\n */\nasync function initializeCategories(): Promise< void > {\n\ttry {\n\t\tconst categories = await apiFetch< AbilityCategory[] >( {\n\t\t\tpath: addQueryArgs( CATEGORIES_ENDPOINT, {\n\t\t\t\tper_page: -1,\n\t\t\t\tcontext: 'edit',\n\t\t\t} ),\n\t\t} );\n\n\t\tif ( categories && Array.isArray( categories ) ) {\n\t\t\tfor ( const category of categories ) {\n\t\t\t\tregisterAbilityCategory( category.slug, {\n\t\t\t\t\tlabel: category.label,\n\t\t\t\t\tdescription: category.description,\n\t\t\t\t\tmeta: {\n\t\t\t\t\t\tannotations: { serverRegistered: true },\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t} catch ( error ) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error( 'Failed to fetch ability categories:', error );\n\t}\n}\n\n/**\n * Fetches and registers all abilities from WordPress.\n */\nasync function initializeAbilities(): Promise< void > {\n\ttry {\n\t\tconst abilities = await apiFetch< Ability[] >( {\n\t\t\tpath: addQueryArgs( ABILITIES_ENDPOINT, {\n\t\t\t\tper_page: -1,\n\t\t\t\tcontext: 'edit',\n\t\t\t} ),\n\t\t} );\n\n\t\tif ( abilities && Array.isArray( abilities ) ) {\n\t\t\tfor ( const ability of abilities ) {\n\t\t\t\t// Register the ability with a callback\n\t\t\t\t// The abilities package filters annotations to allowed keys\n\t\t\t\tregisterAbility( {\n\t\t\t\t\t...ability,\n\t\t\t\t\tcallback: createServerCallback( ability ),\n\t\t\t\t\tmeta: {\n\t\t\t\t\t\tannotations: {\n\t\t\t\t\t\t\t...ability.meta?.annotations,\n\t\t\t\t\t\t\tserverRegistered: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t} catch ( error ) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error( 'Failed to fetch abilities:', error );\n\t}\n}\n\n/**\n * Initialize WordPress abilities integration.\n */\nasync function initialize(): Promise< void > {\n\t// Fetch and register categories, then abilities\n\tawait initializeCategories();\n\tawait initializeAbilities();\n}\n\n// Auto-initialize on import\ninitialize();\n"],
  "mappings": "ygBAAA,IAAAA,EAAAC,EAAA,CAAAC,EAAAC,IAAA,CAAAA,EAAO,QAAU,OAAO,GAAG,WCA3B,IAAAC,EAAAC,EAAA,CAAAC,EAAAC,IAAA,CAAAA,EAAO,QAAU,OAAO,GAAG,MCU3B,IAAAC,EAAqB,OACrBC,EAA6B,OAR7B,OAAS,mBAAAC,EAAiB,2BAAAC,MAA+B,uBAazD,IAAMC,EAAW,mBACXC,EAAqB,GAAID,CAAS,aAClCE,EAAsB,GAAIF,CAAS,cAQzC,SAASG,EACRC,EACsD,CACtD,MAAO,OAAQC,GAAyB,CAEvC,IAAIC,EAAS,OACLF,EAAQ,MAAM,aAAa,SAClCE,EAAS,MAENF,EAAQ,MAAM,aAAa,aAC3BA,EAAQ,MAAM,aAAa,aAE9BE,EAAS,UAGV,IAAIC,EAAO,GAAIN,CAAmB,IAAKG,EAAQ,IAAK,OAC9CI,EAGF,CACH,OAAAF,CACD,EAEA,MACC,CAAE,MAAO,QAAS,EAAE,SAAUA,CAAO,GACrCD,IAAU,MACVA,IAAU,OAGVE,KAAO,gBAAcA,EAAM,CAAE,MAAAF,CAAM,CAAE,EAErCC,IAAW,QACXD,IAAU,MACVA,IAAU,SAEVG,EAAQ,KAAO,CAAE,MAAAH,CAAM,MAIjB,EAAAI,SAA2B,CACjC,KAAAF,EACA,GAAGC,CACJ,CAAE,CACH,CACD,CAKA,eAAeE,GAAwC,CACtD,GAAI,CACH,IAAMC,EAAa,QAAM,EAAAF,SAA+B,CACvD,QAAM,gBAAcP,EAAqB,CACxC,SAAU,GACV,QAAS,MACV,CAAE,CACH,CAAE,EAEF,GAAKS,GAAc,MAAM,QAASA,CAAW,EAC5C,QAAYC,KAAYD,EACvBZ,EAAyBa,EAAS,KAAM,CACvC,MAAOA,EAAS,MAChB,YAAaA,EAAS,YACtB,KAAM,CACL,YAAa,CAAE,iBAAkB,EAAK,CACvC,CACD,CAAE,CAGL,OAAUC,EAAQ,CAEjB,QAAQ,MAAO,sCAAuCA,CAAM,CAC7D,CACD,CAKA,eAAeC,GAAuC,CACrD,GAAI,CACH,IAAMC,EAAY,QAAM,EAAAN,SAAuB,CAC9C,QAAM,gBAAcR,EAAoB,CACvC,SAAU,GACV,QAAS,MACV,CAAE,CACH,CAAE,EAEF,GAAKc,GAAa,MAAM,QAASA,CAAU,EAC1C,QAAYX,KAAWW,EAGtBjB,EAAiB,CAChB,GAAGM,EACH,SAAUD,EAAsBC,CAAQ,EACxC,KAAM,CACL,YAAa,CACZ,GAAGA,EAAQ,MAAM,YACjB,iBAAkB,EACnB,CACD,CACD,CAAE,CAGL,OAAUS,EAAQ,CAEjB,QAAQ,MAAO,6BAA8BA,CAAM,CACpD,CACD,CAKA,eAAeG,GAA8B,CAE5C,MAAMN,EAAqB,EAC3B,MAAMI,EAAoB,CAC3B,CAGAE,EAAW",
  "names": ["require_api_fetch", "__commonJSMin", "exports", "module", "require_url", "__commonJSMin", "exports", "module", "import_api_fetch", "import_url", "registerAbility", "registerAbilityCategory", "API_BASE", "ABILITIES_ENDPOINT", "CATEGORIES_ENDPOINT", "createServerCallback", "ability", "input", "method", "path", "options", "apiFetch", "initializeCategories", "categories", "category", "error", "initializeAbilities", "abilities", "initialize"]
}
