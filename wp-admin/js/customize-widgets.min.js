!function(s,h){var u,f;function g(e){var t={number:null,id_base:null},i=e.match(/^(.+)-(\d+)$/);return i?(t.id_base=i[1],t.number=parseInt(i[2],10)):t.id_base=e,t}s&&s.customize&&((u=s.customize).Widgets=u.Widgets||{},u.Widgets.data=_wpCustomizeWidgetsSettings||{},f=u.Widgets.data.l10n,delete u.Widgets.data.l10n,u.Widgets.WidgetModel=Backbone.Model.extend({id:null,temp_id:null,classname:null,control_tpl:null,description:null,is_disabled:null,is_multi:null,multi_number:null,name:null,id_base:null,transport:"refresh",params:[],width:null,height:null,search_matched:!0}),u.Widgets.WidgetCollection=Backbone.Collection.extend({model:u.Widgets.WidgetModel,doSearch:function(e){this.terms!==e&&(this.terms=e,0<this.terms.length&&this.search(this.terms),""===this.terms&&this.each(function(e){e.set("search_matched",!0)}))},search:function(e){var t,i;e=(e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/ /g,")(?=.*"),t=new RegExp("^(?=.*"+e+").+","i"),this.each(function(e){i=[e.get("name"),e.get("id"),e.get("description")].join(" "),e.set("search_matched",t.test(i))})}}),u.Widgets.availableWidgets=new u.Widgets.WidgetCollection(u.Widgets.data.availableWidgets),u.Widgets.SidebarModel=Backbone.Model.extend({after_title:null,after_widget:null,before_title:null,before_widget:null,"class":null,description:null,id:null,name:null,is_rendered:!1}),u.Widgets.SidebarCollection=Backbone.Collection.extend({model:u.Widgets.SidebarModel}),u.Widgets.registeredSidebars=new u.Widgets.SidebarCollection(u.Widgets.data.registeredSidebars),u.Widgets.AvailableWidgetsPanelView=s.Backbone.View.extend({el:"#available-widgets",events:{"input #widgets-search":"search","keyup #widgets-search":"search","change #widgets-search":"search","search #widgets-search":"search","focus .widget-tpl":"focus","click .widget-tpl":"_submit","keypress .widget-tpl":"_submit",keydown:"keyboardAccessible"},selected:null,currentSidebarControl:null,$search:null,initialize:function(){var t=this;this.$search=h("#widgets-search"),_.bindAll(this,"close"),this.listenTo(this.collection,"change",this.updateList),this.updateList(),h("#customize-controls").on("click keydown",function(e){e=h(e.target).is(".add-new-widget, .add-new-widget *");h("body").hasClass("adding-widget")&&!e&&t.close()}),u.previewer.bind("url",this.close)},search:function(e){var t;this.collection.doSearch(e.target.value),this.selected&&!this.selected.is(":visible")&&(this.selected.removeClass("selected"),this.selected=null),this.selected&&!e.target.value&&(this.selected.removeClass("selected"),this.selected=null),!this.selected&&e.target.value&&(t=this.$el.find("> .widget-tpl:visible:first")).length&&this.select(t)},updateList:function(){this.collection.each(function(e){var t=h("#widget-tpl-"+e.id);t.toggle(e.get("search_matched")&&!e.get("is_disabled")),e.get("is_disabled")&&t.is(this.selected)&&(this.selected=null)})},select:function(e){this.selected=h(e),this.selected.siblings(".widget-tpl").removeClass("selected"),this.selected.addClass("selected")},focus:function(e){this.select(h(e.currentTarget))},_submit:function(e){"keypress"===e.type&&13!==e.which&&32!==e.which||this.submit(h(e.currentTarget))},submit:function(e){(e=e||this.selected)&&this.currentSidebarControl&&(this.select(e),e=h(this.selected).data("widget-id"),(e=this.collection.findWhere({id:e}))&&(this.currentSidebarControl.addWidget(e.get("id_base")),this.close()))},open:function(e){this.currentSidebarControl=e,_(this.currentSidebarControl.getWidgetFormControls()).each(function(e){e.params.is_wide&&e.collapseForm()}),h("body").addClass("adding-widget"),this.$el.find(".selected").removeClass("selected"),this.collection.doSearch(""),this.$search.focus()},close:function(e){(e=e||{}).returnFocus&&this.currentSidebarControl&&this.currentSidebarControl.container.find(".add-new-widget").focus(),this.currentSidebarControl=null,this.selected=null,h("body").removeClass("adding-widget"),this.$search.val("")},keyboardAccessible:function(e){var t=13===e.which,i=27===e.which,n=40===e.which,s=38===e.which,d=9===e.which,o=e.shiftKey,a=null,r=this.$el.find("> .widget-tpl:visible:first"),c=this.$el.find("> .widget-tpl:visible:last"),l=h(e.target).is(this.$search),g=h(e.target).is(".widget-tpl:visible:last");if(n||s)return n?l?a=r:this.selected&&0!==this.selected.nextAll(".widget-tpl:visible").length&&(a=this.selected.nextAll(".widget-tpl:visible:first")):s&&(l?a=c:this.selected&&0!==this.selected.prevAll(".widget-tpl:visible").length&&(a=this.selected.prevAll(".widget-tpl:visible:first"))),this.select(a),void(a||this.$search).focus();t&&!this.$search.val()||(t?this.submit():i&&this.close({returnFocus:!0}),d&&(o&&l||!o&&g)&&(this.currentSidebarControl.container.find(".add-new-widget").focus(),e.preventDefault()))}}),u.Widgets.formSyncHandlers={rss:function(e,t,i){var n=t.find(".widget-error:first"),i=h("<div>"+i+"</div>").find(".widget-error:first");n.length&&i.length?n.replaceWith(i):n.length?n.remove():i.length&&t.find(".widget-content:first").prepend(i)}},u.Widgets.WidgetControl=u.Control.extend({ready:function(){this._setupModel(),this._setupWideWidget(),this._setupControlToggle(),this._setupWidgetTitle(),this._setupReorderUI(),this._setupHighlightEffects(),this._setupUpdateUI(),this._setupRemoveUI()},_setupModel:function(){var e,i=this;u.Widgets.savedWidgetIds=u.Widgets.savedWidgetIds||[],e=function(){u.Widgets.savedWidgetIds[i.params.widget_id]=!0},u.bind("ready",e),u.bind("saved",e),this._updateCount=0,this.isWidgetUpdating=!1,this.liveUpdateMode=!0,this.setting.bind(function(e,t){_(t).isEqual(e)||i.isWidgetUpdating||i.updateWidget({instance:e})})},_setupWideWidget:function(){var n,s,e,t,i,d=this;this.params.is_wide&&(n=this.container.find(".widget-inside"),s=n.find("> .form"),e=h(".wp-full-overlay-sidebar-content:first"),this.container.addClass("wide-widget-control"),this.container.find(".widget-content:first").css({"max-width":this.params.width,"min-height":this.params.height}),i=function(){var e=d.container.offset().top,t=h(window).height(),i=s.outerHeight();n.css("max-height",t),i=Math.max(0,Math.min(Math.max(e,0),t-i)),n.css("top",i)},t=h("#customize-theme-controls"),this.container.on("expand",function(){i(),e.on("scroll",i),h(window).on("resize",i),t.on("expanded collapsed",i)}),this.container.on("collapsed",function(){e.off("scroll",i),h(window).off("resize",i),t.off("expanded collapsed",i)}),u.each(function(e){0===e.id.indexOf("sidebars_widgets[")&&e.bind(function(){d.container.hasClass("expanded")&&i()})}))},_setupControlToggle:function(){var t=this;this.container.find(".widget-top").on("click",function(e){e.preventDefault(),t.getSidebarWidgetsControl().isReordering||t.toggleForm()}),this.container.find(".widget-control-close").on("click",function(e){e.preventDefault(),t.collapseForm(),t.container.find(".widget-top .widget-action:first").focus()})},_setupWidgetTitle:function(){var i=this,e=function(){var e=i.setting().title,t=i.container.find(".in-widget-title");e?t.text(": "+e):t.text("")};this.setting.bind(e),e()},_setupReorderUI:function(){var t,e,d=this,n=function(e){e.siblings(".selected").removeClass("selected"),e.addClass("selected");e=e.data("id")===d.params.sidebar_id;d.container.find(".move-widget-btn").prop("disabled",e)};this.container.find(".widget-title-action").after(h(u.Widgets.data.tpl.widgetReorderNav)),t=h(_.template(u.Widgets.data.tpl.moveWidgetArea,{sidebars:_(u.Widgets.registeredSidebars.toArray()).pluck("attributes")})),this.container.find(".widget-top").after(t),(e=function(){var e=t.find("li"),i=e.filter(function(){return h(this).data("id")===d.params.sidebar_id});e.each(function(){var e=h(this),t=e.data("id"),t=u.Widgets.registeredSidebars.get(t);e.toggle(t.get("is_rendered")),e.hasClass("selected")&&!t.get("is_rendered")&&n(i)})})(),u.Widgets.registeredSidebars.on("change:is_rendered",e),this.container.find(".widget-reorder-nav").find(".move-widget, .move-widget-down, .move-widget-up").each(function(){h(this).prepend(d.container.find(".widget-title").text()+": ")}).on("click keypress",function(e){var t,i;"keypress"===e.type&&13!==e.which&&32!==e.which||(h(this).focus(),h(this).is(".move-widget")?d.toggleWidgetMoveArea():(t=h(this).is(".move-widget-down"),i=h(this).is(".move-widget-up"),e=d.getWidgetSidebarPosition(),i&&0===e||t&&e===d.getSidebarWidgetsControl().setting().length-1||(i?d.moveUp():d.moveDown(),h(this).focus())))}),this.container.find(".widget-area-select").on("click keypress","li",function(e){"keypress"===event.type&&13!==event.which&&32!==event.which||(e.preventDefault(),n(h(this)))}),this.container.find(".move-widget-btn").click(function(){d.getSidebarWidgetsControl().toggleReordering(!1);var e=d.params.sidebar_id,t=d.container.find(".widget-area-select li.selected").data("id"),i=u("sidebars_widgets["+e+"]"),n=u("sidebars_widgets["+t+"]"),s=Array.prototype.slice.call(i()),e=Array.prototype.slice.call(n()),t=d.getWidgetSidebarPosition();s.splice(t,1),e.push(d.params.widget_id),i(s),n(e),d.focus()})},_setupHighlightEffects:function(){var e=this;this.container.on("mouseenter click",function(){e.setting.previewer.send("highlight-widget",e.params.widget_id)}),this.setting.bind(function(){e.setting.previewer.send("highlight-widget",e.params.widget_id)})},_setupUpdateUI:function(){var t,i,n=this,s=this.container.find(".widget:first"),e=s.find(".widget-content:first"),d=this.container.find(".widget-control-save");d.val(f.saveBtnLabel),d.attr("title",f.saveBtnTooltip),d.removeClass("button-primary").addClass("button-secondary"),d.on("click",function(e){e.preventDefault(),n.updateWidget({disable_form:!0})}),t=_.debounce(function(){n.updateWidget()},250),e.on("keydown","input",function(e){13===e.which&&(e.preventDefault(),n.updateWidget({ignoreActiveElement:!0}))}),e.on("change input propertychange",":input",function(e){n.liveUpdateMode&&("change"===e.type?n.updateWidget():this.checkValidity&&this.checkValidity()&&t())}),this.setting.previewer.channel.bind("synced",function(){n.container.removeClass("previewer-loading")}),u.previewer.bind("widget-updated",function(e){e===n.params.widget_id&&n.container.removeClass("previewer-loading")}),(i=u.Widgets.formSyncHandlers[this.params.widget_id_base])&&h(document).on("widget-synced",function(e,t){s.is(t)&&i.apply(document,arguments)})},toggle:function(e){this.container.toggleClass("widget-rendered",e)},_setupRemoveUI:function(){var e,s=this,t=this.container.find("a.widget-control-remove");t.on("click",function(e){var n;e.preventDefault(),n=s.container.next().is(".customize-control-widget_form")?s.container.next().find(".widget-action:first"):s.container.prev().is(".customize-control-widget_form")?s.container.prev().find(".widget-action:first"):s.container.next(".customize-control-sidebar_widgets").find(".add-new-widget:first"),s.container.slideUp(function(){var e,t,i=u.Widgets.getSidebarWidgetControlContainingWidget(s.params.widget_id);i&&(e=i.setting().slice(),-1!==(t=_.indexOf(e,s.params.widget_id))&&(e.splice(t,1),i.setting(e),n.focus()))})}),e=function(){t.text(f.removeBtnLabel),t.attr("title",f.removeBtnTooltip)},this.params.is_new?u.bind("saved",e):e()},_getInputs:function(e){return h(e).find(":input[name]")},_getInputsSignature:function(e){return _(e).map(function(e){e=h(e),e=e.is(":checkbox, :radio")?[e.attr("id"),e.attr("name"),e.prop("value")]:[e.attr("id"),e.attr("name")];return e.join(",")}).join(";")},_getInputStatePropertyName:function(e){return h(e).is(":radio, :checkbox")?"checked":"value"},getSidebarWidgetsControl:function(){var e="sidebars_widgets["+this.params.sidebar_id+"]",e=u.control(e);if(e)return e},updateWidget:function(d){var n,o,a,r,e,t,c,l=this,i=(d=h.extend({instance:null,complete:null,ignoreActiveElement:!1},d)).instance,g=d.complete;this._updateCount+=1,a=this._updateCount,n=this.container.find(".widget:first"),(o=n.find(".widget-content:first")).find(".widget-error").remove(),this.container.addClass("widget-form-loading"),this.container.addClass("previewer-loading"),(e=u.state("processing"))(e()+1),this.liveUpdateMode||this.container.addClass("widget-form-disabled"),(t={action:"update-widget",wp_customize:"on"}).nonce=u.Widgets.data.nonce,t.theme=u.settings.theme.stylesheet,t=h.param(t),(r=this._getInputs(o)).each(function(){var e=h(this),t=l._getInputStatePropertyName(this);e.data("state"+a,e.prop(t))}),t+=i?"&"+h.param({sanitized_widget_setting:JSON.stringify(i)}):"&"+r.serialize(),t+="&"+o.find("~ :input").serialize(),(t=h.post(s.ajax.settings.url,t)).done(function(e){var s,t,i=!1;if("0"===e)return u.previewer.preview.iframe.hide(),void u.previewer.login().done(function(){l.updateWidget(d),u.previewer.preview.iframe.show()});"-1"!==e?e.success?(t=h("<div>"+e.data.form+"</div>"),s=l._getInputs(t),(t=l._getInputsSignature(r)===l._getInputsSignature(s))&&!l.liveUpdateMode&&(l.liveUpdateMode=!0,l.container.removeClass("widget-form-disabled"),l.container.find('input[name="savewidget"]').hide()),t&&l.liveUpdateMode?(r.each(function(e){var t=h(this),i=h(s[e]),n=l._getInputStatePropertyName(this),e=t.data("state"+a),i=i.prop(n);t.data("sanitized",i),e===i||!d.ignoreActiveElement&&t.is(document.activeElement)||t.prop(n,i)}),h(document).trigger("widget-synced",[n,e.data.form])):l.liveUpdateMode?(l.liveUpdateMode=!1,l.container.find('input[name="savewidget"]').show(),i=!0):(o.html(e.data.form),l.container.removeClass("widget-form-disabled"),h(document).trigger("widget-updated",[n])),(c=!i&&!_(l.setting()).isEqual(e.data.instance))?(l.isWidgetUpdating=!0,l.setting(e.data.instance),l.isWidgetUpdating=!1):l.container.removeClass("previewer-loading"),g&&g.call(l,null,{noChange:!c,ajaxFinished:!0})):(i=f.error,e.data&&e.data.message&&(i=e.data.message),g?g.call(l,i):o.prepend('<p class="widget-error"><strong>'+i+"</strong></p>")):u.previewer.cheatin()}),t.fail(function(e,t){g&&g.call(l,t)}),t.always(function(){l.container.removeClass("widget-form-loading"),r.each(function(){h(this).removeData("state"+a)}),e(e()-1)})},expandControlSection:function(){var e=this.container.closest(".accordion-section");e.hasClass("open")||e.find(".accordion-section-title:first").trigger("click")},expandForm:function(){this.toggleForm(!0)},collapseForm:function(){this.toggleForm(!1)},toggleForm:function(e){var t,i=this,n=this.container.find("div.widget:first"),s=n.find(".widget-inside:first");void 0===e&&(e=!s.is(":visible")),s.is(":visible")!==e&&(e?(u.control.each(function(e){i.params.type===e.params.type&&i!==e&&e.collapseForm()}),t=function(){i.container.removeClass("expanding"),i.container.addClass("expanded"),i.container.trigger("expanded")},i.params.is_wide?s.fadeIn("fast",t):s.slideDown("fast",t),i.container.trigger("expand"),i.container.addClass("expanding")):(t=function(){i.container.removeClass("collapsing"),i.container.removeClass("expanded"),i.container.trigger("collapsed")},i.container.trigger("collapse"),i.container.addClass("collapsing"),i.params.is_wide?s.fadeOut("fast",t):s.slideUp("fast",function(){n.css({width:"",margin:""}),t()})))},focus:function(){this.expandControlSection(),this.expandForm(),this.container.find(".widget-content :focusable:first").focus()},getWidgetSidebarPosition:function(){var e=this.getSidebarWidgetsControl().setting(),e=_.indexOf(e,this.params.widget_id);if(-1!==e)return e},moveUp:function(){this._moveWidgetByOne(-1)},moveDown:function(){this._moveWidgetByOne(1)},_moveWidgetByOne:function(e){var t=this.getWidgetSidebarPosition(),i=this.getSidebarWidgetsControl().setting,n=Array.prototype.slice.call(i()),s=n[t+e];n[t+e]=this.params.widget_id,n[t]=s,i(n)},toggleWidgetMoveArea:function(e){var t=this,i=this.container.find(".move-widget-area");(e=void 0===e?!i.hasClass("active"):e)&&(i.find(".selected").removeClass("selected"),i.find("li").filter(function(){return h(this).data("id")===t.params.sidebar_id}).addClass("selected"),this.container.find(".move-widget-btn").prop("disabled",!0)),i.toggleClass("active",e)},highlightSectionAndControl:function(){var e=this.container.is(":hidden")?this.container.closest(".control-section"):this.container;h(".highlighted").removeClass("highlighted"),e.addClass("highlighted"),setTimeout(function(){e.removeClass("highlighted")},500)}}),u.Widgets.SidebarControl=u.Control.extend({ready:function(){this.$controlSection=this.container.closest(".control-section"),this.$sectionContent=this.container.closest(".accordion-section-content"),this._setupModel(),this._setupSortable(),this._setupAddition(),this._applyCardinalOrderClassNames()},_setupModel:function(){var d=this,t=u.Widgets.registeredSidebars.get(this.params.sidebar_id);this.setting.bind(function(i,e){var t,n=_(e).difference(i);i=_(i).filter(function(e){e=g(e);return!!u.Widgets.availableWidgets.findWhere({id_base:e.id_base})}),(t=_(i).map(function(e){return u.Widgets.getWidgetFormControlForWidget(e)||d.addWidget(e)})).sort(function(e,t){e=_.indexOf(i,e.params.widget_id),t=_.indexOf(i,t.params.widget_id);return e===t?0:e<t?-1:1}),e=_(t).map(function(e){return e.container[0]}),d.$sectionContent.find(".customize-control-sidebar_widgets").before(e),d._applyCardinalOrderClassNames(),_(t).each(function(e){e.params.sidebar_id=d.params.sidebar_id}),_(n).each(function(s){setTimeout(function(){var e,t,i,n=!1;u.each(function(e){e.id!==d.setting.id&&0===e.id.indexOf("sidebars_widgets[")&&"sidebars_widgets[wp_inactive_widgets]"!==e.id&&(e=e(),-1!==_.indexOf(e,s)&&(n=!0))}),n||(t=(e=u.Widgets.getWidgetFormControlForWidget(s))&&h.contains(document,e.container[0])&&!h.contains(d.$sectionContent[0],e.container[0]),e&&!t&&(u.control.remove(e.id),e.container.remove()),u.Widgets.savedWidgetIds[s]&&((i=u.value("sidebars_widgets[wp_inactive_widgets]")().slice()).push(s),u.value("sidebars_widgets[wp_inactive_widgets]")(_(i).unique())),i=g(s).id_base,(i=u.Widgets.availableWidgets.findWhere({id_base:i}))&&!i.get("is_multi")&&i.set("is_disabled",!1))})})}),d.active.bind(function(e){t.set("is_rendered",e)})},toggle:function(e){var t="#accordion-section-sidebar-widgets-"+this.params.sidebar_id,t=h(t);e?t.stop().slideDown(function(){h(this).css("height","auto")}):(t.hasClass("open")&&t.find(".accordion-section-title").trigger("click"),t.stop().slideUp())},_setupSortable:function(){var t=this;this.isReordering=!1,this.$sectionContent.sortable({items:"> .customize-control-widget_form",handle:".widget-top",axis:"y",connectWith:".accordion-section-content:has(.customize-control-sidebar_widgets)",update:function(){var e=t.$sectionContent.sortable("toArray"),e=h.map(e,function(e){return h("#"+e).find(":input[name=widget-id]").val()});t.setting(e)}}),this.$controlSection.find(".accordion-section-title").droppable({accept:".customize-control-widget_form",over:function(){t.$controlSection.hasClass("open")||(t.$controlSection.addClass("open"),t.$sectionContent.toggle(!1).slideToggle(150,function(){t.$sectionContent.sortable("refreshPositions")}))}}),this.container.find(".reorder-toggle").on("click keydown",function(e){"keydown"===e.type&&13!==e.which&&32!==e.which||t.toggleReordering(!t.isReordering)})},_setupAddition:function(){var t=this;this.container.find(".add-new-widget").on("click keydown",function(e){"keydown"===e.type&&13!==e.which&&32!==e.which||t.$sectionContent.hasClass("reordering")||(h("body").hasClass("adding-widget")?u.Widgets.availableWidgetsPanel.close():u.Widgets.availableWidgetsPanel.open(t))})},_applyCardinalOrderClassNames:function(){this.$sectionContent.find(".customize-control-widget_form").removeClass("first-widget").removeClass("last-widget").find(".move-widget-down, .move-widget-up").prop("tabIndex",0),this.$sectionContent.find(".customize-control-widget_form:first").addClass("first-widget").find(".move-widget-up").prop("tabIndex",-1),this.$sectionContent.find(".customize-control-widget_form:last").addClass("last-widget").find(".move-widget-down").prop("tabIndex",-1)},toggleReordering:function(e){(e=Boolean(e))!==this.$sectionContent.hasClass("reordering")&&(this.isReordering=e,this.$sectionContent.toggleClass("reordering",e),e?(_(this.getWidgetFormControls()).each(function(e){e.collapseForm()}),this.$sectionContent.find(".first-widget .move-widget").focus(),this.$sectionContent.find(".add-new-widget").prop("tabIndex",-1)):this.$sectionContent.find(".add-new-widget").prop("tabIndex",0))},getWidgetFormControls:function(){return _(this.setting()).map(function(e){e=function(e){var t=g(e);e="widget_"+t.id_base,t.number&&(e+="["+t.number+"]");return e}(e),e=u.control(e);if(e)return e})},addWidget:function(n){var e,t,i,s,d=this,o="widget_form",a=g(n),r=a.number,c=a.id_base,l=u.Widgets.availableWidgets.findWhere({id_base:c});return!!l&&(!(r&&!l.get("is_multi"))&&(l.get("is_multi")&&!r&&(l.set("multi_number",l.get("multi_number")+1),r=l.get("multi_number")),i=h.trim(h("#widget-tpl-"+l.get("id")).html()),l.get("is_multi")?i=i.replace(/<[^<>]+>/g,function(e){return e.replace(/__i__|%i%/g,r)}):l.set("is_disabled",!0),a=h(i),(c=h("<li/>").addClass("customize-control").addClass("customize-control-"+o).append(a)).find("> .widget-icon").remove(),l.get("is_multi")&&(c.find('input[name="widget_number"]').val(r),c.find('input[name="multi_number"]').val(r)),n=c.find('[name="widget-id"]').val(),c.hide(),i="widget_"+l.get("id_base"),l.get("is_multi")&&(i+="["+r+"]"),c.attr("id","customize-control-"+i.replace(/\]/g,"").replace(/\[/g,"-")),this.container.after(c),(e=u.has(i))||(s={transport:"refresh",previewer:this.setting.previewer},u.create(i,i,{},s)),s=u.controlConstructor[o],t=new s(i,{params:{settings:{"default":i},sidebar_id:d.params.sidebar_id,widget_id:n,widget_id_base:l.get("id_base"),type:o,is_new:!e,width:l.get("width"),height:l.get("height"),is_wide:l.get("is_wide")},previewer:d.setting.previewer}),u.control.add(i,t),u.each(function(e){var t,i;e.id!==d.setting.id&&0===e.id.indexOf("sidebars_widgets[")&&(t=e().slice(),-1!==(i=_.indexOf(t,n))&&(t.splice(i),e(t)))}),i=this.setting().slice(),-1===_.indexOf(i,n)&&(i.push(n),this.setting(i)),c.slideDown(function(){e?(t.expandForm(),t.updateWidget({instance:t.setting(),complete:function(e){if(e)throw e;t.focus()}})):t.focus()}),h(document).trigger("widget-added",[a]),t))}}),h.extend(u.controlConstructor,{widget_form:u.Widgets.WidgetControl,sidebar_widgets:u.Widgets.SidebarControl}),u.bind("ready",function(){u.Widgets.availableWidgetsPanel=new u.Widgets.AvailableWidgetsPanelView({collection:u.Widgets.availableWidgets}),u.previewer.bind("highlight-widget-control",u.Widgets.highlightWidgetFormControl),u.previewer.bind("focus-widget-control",u.Widgets.focusWidgetFormControl)}),u.Widgets.highlightWidgetFormControl=function(e){e=u.Widgets.getWidgetFormControlForWidget(e);e&&e.highlightSectionAndControl()},u.Widgets.focusWidgetFormControl=function(e){e=u.Widgets.getWidgetFormControlForWidget(e);e&&e.focus()},u.Widgets.getSidebarWidgetControlContainingWidget=function(t){var i=null;return u.control.each(function(e){"sidebar_widgets"===e.params.type&&-1!==_.indexOf(e.setting(),t)&&(i=e)}),i},u.Widgets.getWidgetFormControlForWidget=function(t){var i=null;return u.control.each(function(e){"widget_form"===e.params.type&&e.params.widget_id===t&&(i=e)}),i})}(window.wp,jQuery);