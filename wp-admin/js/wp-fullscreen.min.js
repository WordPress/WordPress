var fullscreen,wptitlehint,PubSub=function(){this.topics={}};PubSub.prototype.subscribe=function(e,t){return this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t),t},PubSub.prototype.unsubscribe=function(e,t){var i,n,o=this.topics[e];if(!o)return t||[];if(t){for(i=0,n=o.length;i<n;i++)t==o[i]&&o.splice(i,1);return t}return this.topics[e]=[],o},PubSub.prototype.publish=function(e,t){var i,n,o,s=this.topics[e];if(s){for(t=t||[],i=0,n=s.length;i<n;i++)o=!1===s[i].apply(null,t)||o;return!o}},function(l){var o,r,n,c,d,t,e;fullscreen=o={},r=o.pubsub=new PubSub,d=!1,c=o.settings={visible:!1,mode:"tinymce",editor_id:"content",title_id:"",timer:0,toolbar_shown:!1},n=o.bounder=function(e,t,i,n){var o,s;i=i||1250,n&&(o=n.pageY||n.clientY||n.offsetY,s=l(document).scrollTop(),120<(o=!n.isDefaultPrevented?135+o:o)-s)||d||(d=!0,setTimeout(function(){d=!1},400),c.timer?clearTimeout(c.timer):r.publish(e),c.timer=setTimeout(function(){r.publish(t),c.timer=0},i))},o.on=function(){c.visible||("object"==typeof wp_fullscreen_settings&&l.extend(c,wp_fullscreen_settings),c.editor_id=wpActiveEditor||"content",l("input#title").length&&"content"==c.editor_id?c.title_id="title":l("input#"+c.editor_id+"-title").length?c.title_id=c.editor_id+"-title":l("#wp-fullscreen-title, #wp-fullscreen-title-prompt-text").hide(),c.mode=l("#"+c.editor_id).is(":hidden")?"tinymce":"html",c.qt_canvas=l("#"+c.editor_id).get(0),c.element||o.ui.init(),c.is_mce_on=c.has_tinymce&&void 0!==tinymce.get(c.editor_id),o.ui.fade("show","showing","shown"))},o.off=function(){c.visible&&o.ui.fade("hide","hiding","hidden")},o.switchmode=function(e){var t=c.mode;return!(e&&c.visible&&c.has_tinymce)||t==e?t:(r.publish("switchMode",[t,e]),c.mode=e,r.publish("switchedMode",[t,e]),e)},o.save=function(){var e=l("#hiddenaction"),t=e.val(),i=l("#wp-fullscreen-save .spinner"),n=l("#wp-fullscreen-save span");i.show(),o.savecontent(),e.val("wp-fullscreen-save-post"),l.post(ajaxurl,l("form#post").serialize(),function(e){i.hide(),n.show(),setTimeout(function(){n.fadeOut(1e3)},3e3),e.last_edited&&l("#wp-fullscreen-save input").attr("title",e.last_edited)},"json"),e.val(t)},o.savecontent=function(){var e;c.title_id&&l("#"+c.title_id).val(l("#wp-fullscreen-title").val()),e="tinymce"===c.mode&&(e=tinymce.get("wp_mce_fullscreen"))?e.save():l("#wp_mce_fullscreen").val(),l("#"+c.editor_id).val(e),l(document).triggerHandler("wpcountwords",[e])},t=function(e){e.val().length?e.siblings("label").css("visibility","hidden"):e.siblings("label").css("visibility","")},o.dfw_width=function(e){var t=l("#wp-fullscreen-wrap"),i=t.width();if(!e)return t.width(l("#wp-fullscreen-central-toolbar").width()),void deleteUserSetting("dfw_width");(i=e+i)<200||1200<i||(t.width(i),setUserSetting("dfw_width",i))},r.subscribe("showToolbar",function(){c.toolbars.removeClass("fade-1000").addClass("fade-300"),o.fade.In(c.toolbars,300,function(){r.publish("toolbarShown")},!0),l("#wp-fullscreen-body").addClass("wp-fullscreen-focus"),c.toolbar_shown=!0}),r.subscribe("hideToolbar",function(){c.toolbars.removeClass("fade-300").addClass("fade-1000"),o.fade.Out(c.toolbars,1e3,function(){r.publish("toolbarHidden")},!0),l("#wp-fullscreen-body").removeClass("wp-fullscreen-focus")}),r.subscribe("toolbarShown",function(){c.toolbars.removeClass("fade-300")}),r.subscribe("toolbarHidden",function(){c.toolbars.removeClass("fade-1000"),c.toolbar_shown=!1}),r.subscribe("show",function(){var e;c.title_id&&(e=l("#wp-fullscreen-title").val(l("#"+c.title_id).val()),t(e)),l("#wp-fullscreen-save input").attr("title",l("#last-edit").text()),c.textarea_obj.value=c.qt_canvas.value,c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("wpFullScreenInit"),c.orig_y=l(window).scrollTop()}),r.subscribe("showing",function(){l(document.body).addClass("fullscreen-active"),o.refresh_buttons(),l(document).bind("mousemove.fullscreen",function(e){n("showToolbar","hideToolbar",2e3,e)}),n("showToolbar","hideToolbar",2e3),o.bind_resize(),setTimeout(o.resize_textarea,200),scrollTo(0,0),l("#wpadminbar").hide()}),r.subscribe("shown",function(){var s;c.visible=!0,c.has_tinymce&&!c.is_mce_on&&(s=function(e,t){var i=t.getElement(),n=i.value,o=tinyMCEPreInit.mceInit[c.editor_id];o&&o.wpautop&&"undefined"!=typeof switchEditors&&(i.value=switchEditors.wpautop(i.value)),t.onInit.add(function(e){e.hide(),e.getElement().value=n,tinymce.onAddEditor.remove(s)})},tinymce.onAddEditor.add(s),tinymce.init(tinyMCEPreInit.mceInit[c.editor_id]),c.is_mce_on=!0),wpActiveEditor="wp_mce_fullscreen"}),r.subscribe("hide",function(){var e=l("#"+c.editor_id).is(":hidden");c.has_tinymce&&"tinymce"===c.mode&&!e?switchEditors.go(c.editor_id,"tmce"):"html"===c.mode&&e&&switchEditors.go(c.editor_id,"html"),o.savecontent(),l(document).unbind(".fullscreen"),l(c.textarea_obj).unbind(".grow"),c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("wpFullScreenSave"),c.title_id&&t(l("#"+c.title_id)),c.qt_canvas.value=c.textarea_obj.value}),r.subscribe("hiding",function(){l(document.body).removeClass("fullscreen-active"),scrollTo(0,c.orig_y),l("#wpadminbar").show()}),r.subscribe("hidden",function(){c.visible=!1,l("#wp_mce_fullscreen, #wp-fullscreen-title").removeAttr("style"),c.has_tinymce&&c.is_mce_on&&tinymce.execCommand("wpFullScreenClose"),c.textarea_obj.value="",o.oldheight=0,wpActiveEditor=c.editor_id}),r.subscribe("switchMode",function(e,t){var i;c.has_tinymce&&c.is_mce_on&&(i=tinymce.get("wp_mce_fullscreen"),"html"===e&&"tinymce"===t?(tinymce.get(c.editor_id).getParam("wpautop")&&"undefined"!=typeof switchEditors&&(c.textarea_obj.value=switchEditors.wpautop(c.textarea_obj.value)),void 0===i?tinymce.execCommand("wpFullScreenInit"):i.show()):"tinymce"===e&&"html"===t&&i&&i.hide())}),r.subscribe("switchedMode",function(e,t){o.refresh_buttons(!0),"html"===t&&setTimeout(o.resize_textarea,200)}),o.b=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("Bold")},o.i=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("Italic")},o.ul=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("InsertUnorderedList")},o.ol=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("InsertOrderedList")},o.link=function(){c.has_tinymce&&"tinymce"===c.mode?tinymce.execCommand("WP_Link"):wpLink.open()},o.unlink=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("unlink")},o.atd=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("mceWritingImprovementTool")},o.help=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("WP_Help")},o.blockquote=function(){c.has_tinymce&&"tinymce"===c.mode&&tinymce.execCommand("mceBlockQuote")},o.medialib=function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(c.editor_id)},o.refresh_buttons=function(e){e=e||!1,"html"===c.mode?(l("#wp-fullscreen-mode-bar").removeClass("wp-tmce-mode").addClass("wp-html-mode"),e?l("#wp-fullscreen-button-bar").fadeOut(150,function(){l(this).addClass("wp-html-mode").fadeIn(150)}):l("#wp-fullscreen-button-bar").addClass("wp-html-mode")):"tinymce"===c.mode&&(l("#wp-fullscreen-mode-bar").removeClass("wp-html-mode").addClass("wp-tmce-mode"),e?l("#wp-fullscreen-button-bar").fadeOut(150,function(){l(this).removeClass("wp-html-mode").fadeIn(150)}):l("#wp-fullscreen-button-bar").removeClass("wp-html-mode"))},o.ui={init:function(){var e=l("#fullscreen-topbar"),t=l("#wp_mce_fullscreen"),i=0;c.toolbars=e.add(l("#wp-fullscreen-status")),c.element=l("#fullscreen-fader"),c.textarea_obj=t[0],c.has_tinymce="undefined"!=typeof tinymce,c.has_tinymce||l("#wp-fullscreen-mode-bar").hide(),wptitlehint&&l("#wp-fullscreen-title").length&&wptitlehint("wp-fullscreen-title"),l(document).keyup(function(e){var t,i,n=e.keyCode||e.charCode;if(!fullscreen.settings.visible)return!0;t=navigator.platform&&-1!=navigator.platform.indexOf("Mac")?e.ctrlKey:e.altKey,27==n&&(i={event:e,what:"dfw",cb:fullscreen.off,condition:function(){return!l("#TB_window").is(":visible")&&!l(".wp-dialog").is(":visible")}},jQuery(document).triggerHandler("wp_CloseOnEscape",[i])||fullscreen.off()),!t||61!=n&&107!=n&&187!=n||(o.dfw_width(25),e.preventDefault()),!t||45!=n&&109!=n&&189!=n||(o.dfw_width(-25),e.preventDefault()),t&&48==n&&(o.dfw_width(0),e.preventDefault())}),"undefined"!=typeof wpWordCount&&t.keyup(function(e){e=e.keyCode||e.charCode;return e==i||(13!=e&&8!=i&&46!=i||l(document).triggerHandler("wpcountwords",[t.val()]),i=e),!0}),e.mouseenter(function(){c.toolbars.addClass("fullscreen-make-sticky"),l(document).unbind(".fullscreen"),clearTimeout(c.timer),c.timer=0}).mouseleave(function(){c.toolbars.removeClass("fullscreen-make-sticky"),c.visible&&l(document).bind("mousemove.fullscreen",function(e){n("showToolbar","hideToolbar",2e3,e)})})},fade:function(e,t,i){c.element||o.ui.init(),e&&!r.publish(e)||o.fade.In(c.element,600,function(){t&&r.publish(t),o.fade.Out(c.element,600,function(){i&&r.publish(i)})})}},o.fade={transitionend:"transitionend webkitTransitionEnd oTransitionEnd",sensitivity:100,In:function(e,t,i,n){if(i=i||l.noop,t=t||400,n=n||!1,o.fade.transitions){if(e.is(":visible"))return e.addClass("fade-trigger"),e;e.show(),e.first().one(this.transitionend,function(){i()}),setTimeout(function(){e.addClass("fade-trigger")},this.sensitivity)}else n&&e.stop(),e.css("opacity",1),e.first().fadeIn(t,i),1<e.length&&e.not(":first").fadeIn(t);return e},Out:function(e,t,i,n){return i=i||l.noop,t=t||400,n=n||!1,e.is(":visible")&&(o.fade.transitions?(e.first().one(o.fade.transitionend,function(){e.hasClass("fade-trigger")||(e.hide(),i())}),setTimeout(function(){e.removeClass("fade-trigger")},this.sensitivity)):(n&&e.stop(),e.first().fadeOut(t,i),1<e.length&&e.not(":first").fadeOut(t))),e},transitions:"string"==typeof(e=document.documentElement.style).WebkitTransition||"string"==typeof e.MozTransition||"string"==typeof e.OTransition||"string"==typeof e.transition},o.bind_resize=function(){l(c.textarea_obj).bind("keypress.grow click.grow paste.grow",function(){setTimeout(o.resize_textarea,200)})},o.oldheight=0,o.resize_textarea=function(){var e=c.textarea_obj,t=300<e.scrollHeight?e.scrollHeight:300;t!=o.oldheight&&(e.style.height=t+"px",o.oldheight=t)}}(jQuery);